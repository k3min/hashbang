<!DOCTYPE html>

<html>
<head>
  <title>hashbang.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>hashbang.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Hashbang 2.0.7
Copyright (c) 2016 Kevin Pancake
Hashbang may be freely distributed under the MIT license.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">window</span>) </span>{
<span class="hljs-meta">	"use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="setup">Setup</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Save some bytes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> <span class="hljs-built_in">document</span> = <span class="hljs-built_in">window</span>.document,
		location = <span class="hljs-built_in">window</span>.location,

		html = <span class="hljs-built_in">document</span>.documentElement,

		define = <span class="hljs-built_in">Object</span>.defineProperty,
		clone = <span class="hljs-built_in">Object</span>.create;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Test to check if Trident (IE layout engine).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> isTrident = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">n</span>) </span>{
		<span class="hljs-keyword">var</span> app = navigator.appVersion;
		<span class="hljs-keyword">return</span> <span class="hljs-regexp">/Trident/</span>.test(app) &amp;&amp; app.match(<span class="hljs-regexp">/Trident\/([0-9])/</span>)[<span class="hljs-number">1</span>] &lt;= n;
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Top-level namespace.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> HB = <span class="hljs-built_in">window</span>.HB = {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Current version.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		version: <span class="hljs-string">"2.0.7"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>REST API endpoint.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		endpoint: <span class="hljs-string">"api/:handle"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>This holds all the requested <strong>collections</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		collections: {},</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Call this to fire up Hashbang.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		main: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">home, root</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Handles HTTP requests.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			HB.request = <span class="hljs-keyword">new</span> Request(HB.endpoint);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Hashbang will go back to this hash is something goes wrong.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			HB.home = home || <span class="hljs-built_in">document</span>.links[<span class="hljs-number">0</span>].hash;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Element where the magic happens.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			HB.root = root || <span class="hljs-built_in">window</span>.root;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Object to hold some title properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			HB.title = {
				text: <span class="hljs-built_in">document</span>.title,
				spec: <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">"title"</span>)[<span class="hljs-number">0</span>].dataset.spec
			};</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Set up fallback in case <code>HB.router</code> doesnâ€™t know what to do.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			HB.router.fallback = HB.fallback;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Main route.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			HB.router.add(<span class="hljs-string">"/:collection(/:block)?"</span>, HB.route);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Match routes for initial location.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			HB.router.match();
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Default route.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		route: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">handle, block</span>) </span>{
			<span class="hljs-keyword">var</span> c = HB.collections[handle];

			<span class="hljs-keyword">if</span> (c === <span class="hljs-literal">undefined</span> || c.blocks === <span class="hljs-literal">undefined</span> || HB.noCache) {
				c = HB.collections[handle] = <span class="hljs-keyword">new</span> Collection();
				c.addEventListener(<span class="hljs-string">"update"</span>, HB.update);

				HB.request.get({
					handle: handle,
					success: c.load.bind(c),
					error: HB.fallback
				});
			} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Abort ongoing request
(to prevent unwanted behaviour on slower connections).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				HB.request.xhr.abort();
			}

			c.block = block;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Remove <code>.active</code> form last links.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			lastLinks.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">link</span>) </span>{
				link.classList.remove(<span class="hljs-string">"active"</span>);
			});</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Clear <code>lastLinks</code> array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			lastLinks = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Make the current links <code>.active</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = <span class="hljs-built_in">document</span>.links; i &lt; l.length; i++) {
				<span class="hljs-keyword">if</span> (l[i].hash.substr(<span class="hljs-number">3</span>) === handle) {
					l[i].classList.add(<span class="hljs-string">"active"</span>);
					lastLinks.push(l[i]);
				}
			}
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>This gets called when a <strong>collection</strong> updates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		update: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Save some bytesâ€¦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> detail = event.detail,
				title = HB.title,
				root = HB.root,
				classList = html.classList;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Set the title.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-built_in">document</span>.title = title.spec.format(title.text, detail.title);</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Remove existing children.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">while</span> (root.firstChild) {
				root.removeChild(root.firstChild);
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Append current <strong>collection</strong> to <code>HB.root</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			root.appendChild(<span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Update class to match current <strong>collection</strong> <code>handle</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			classList.remove(lastHandle);
			classList.add(lastHandle = detail.handle);</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Update class to match current <strong>collection</strong> <code>type</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			classList.remove(lastType);
			classList.add(lastType = detail.type);</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Fire the <code>update</code> event on <code>HB.root</code> when a
<strong>collection</strong> updates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			root.dispatchEvent(<span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">"update"</span>, { detail: <span class="hljs-keyword">this</span> }));
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Function to call if <strong>collection</strong> is not found.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		fallback: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
			location.hash = HB.home;
		}
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Array to hold last <code>.active</code> links.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> lastLinks = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Variable to hold last used <strong>collection</strong> <code>handle</code> and <code>type</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> lastHandle, lastType;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2 id="klass">klass</h2>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Create a new class. Add <code>$static</code> to a method name to make it <em>static</em>.
<code>$hidden</code> makes it non-enumerable. You can even define getters/setters.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> klass = <span class="hljs-built_in">window</span>.klass = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">methods</span>) </span>{
		<span class="hljs-keyword">var</span> base = methods.constructor,
			self = (<span class="hljs-keyword">this</span> &amp;&amp; <span class="hljs-keyword">this</span>.prototype) || <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>If extendingâ€¦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> (self) {
			base.prototype = clone(self, { parent: { value: self } });
		}

		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> methods) {
			<span class="hljs-keyword">var</span> method = methods[i],
				property = i.split(<span class="hljs-string">"$"</span>)[<span class="hljs-number">0</span>],
				object = <span class="hljs-regexp">/\$static/</span>.test(i) ? base : base.prototype,
				descriptor = { enumerable: !<span class="hljs-regexp">/\$hidden|^constructor/</span>.test(i) };

			<span class="hljs-keyword">if</span> (method !== <span class="hljs-literal">null</span> &amp;&amp; (<span class="hljs-keyword">typeof</span> method.get === <span class="hljs-string">"function"</span> ||
			                        <span class="hljs-keyword">typeof</span> method.set === <span class="hljs-string">"function"</span>)) {
				descriptor.get = method.get;
				descriptor.set = method.set;
			} <span class="hljs-keyword">else</span> {
				descriptor.value = method;
				descriptor.writable = (<span class="hljs-keyword">typeof</span> method !== <span class="hljs-string">"function"</span>);
			}

			define(object, property, descriptor);
		}

		<span class="hljs-keyword">return</span> base;
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Extend an existing class. To access base <em>class</em> use <code>this.parent</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	define(<span class="hljs-built_in">Object</span>.prototype, <span class="hljs-string">"extend"</span>, {
		value: klass
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <h2 id="document-registerelement">document.registerElement</h2>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>This is just a polyfill.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.registerElement === <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Here are custom elemens stored for convenience.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> customElements = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Function to make a custom element custom.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> register = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">element, p</span>) </span>{
			<span class="hljs-keyword">if</span> (isTrident(<span class="hljs-number">6</span>)) {
				<span class="hljs-built_in">Object</span>.getOwnPropertyNames(p).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">n</span>) </span>{
					define(element, n, <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(p, n));
				});

				<span class="hljs-keyword">return</span>;
			}

			element.__proto__ = p;
		};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>This is (almost) the same as the real deal.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-built_in">document</span>.registerElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">element, props</span>) </span>{
			customElements[element] = props;

			<span class="hljs-keyword">var</span> HTMLCustomElement = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">HTMLCustomElement</span>(<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">var</span> custom = <span class="hljs-built_in">document</span>.createElement(element);

				register(custom, props.prototype);

				<span class="hljs-keyword">return</span> custom;
			};

			HTMLCustomElement.prototype = props.prototype;

			define(HTMLCustomElement.prototype, <span class="hljs-string">"constructor"</span>, {
				value: HTMLCustomElement
			});

			<span class="hljs-keyword">return</span> HTMLCustomElement;
		};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Make existing custom elements custom.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">"DOMContentLoaded"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> customElements) {
				<span class="hljs-keyword">var</span> e, x = customElements[i][<span class="hljs-string">"extends"</span>];

				<span class="hljs-keyword">if</span> (x !== <span class="hljs-literal">undefined</span>) {
					e = <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">"{}[is={}]"</span>.format(x, i));
				} <span class="hljs-keyword">else</span> {
					e = <span class="hljs-built_in">document</span>.getElementsByTagName(i);
				}

				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; e.length; j++) {
					register(e[j], customElements[i].prototype);

					<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> e[j].attachedCallback === <span class="hljs-string">"function"</span>) {
						e[j].attachedCallback.call(e[j]);
					}
				}
			}
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>TODO: <code>MutationObserver</code> here.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	}</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h2 id="hb-template">HB.Template</h2>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p><code>HTMLTemplateElement</code> polyfill.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.HTMLTemplateElement === <span class="hljs-literal">undefined</span>) {
		<span class="hljs-built_in">window</span>.HTMLTemplateElement = HTMLElement.extend({
			<span class="hljs-keyword">constructor</span>: function HTMLTemplateElement() {
				<span class="hljs-built_in">console</span>.error(<span class="hljs-string">"Illegal constructor"</span>);
			}
		});
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Make the <code>HB.Template</code> <em>class</em> a custom element for ease and awesomeness.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	HB.Template = <span class="hljs-built_in">document</span>.registerElement(<span class="hljs-string">"hb-template"</span>, {
		prototype: clone(HTMLTemplateElement.prototype, {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Resig modified template function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			attachedCallback: { value: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">var</span> text = <span class="hljs-keyword">this</span>.innerHTML;

				text = text.replace(<span class="hljs-regexp">/\s{2,}/g</span>, <span class="hljs-string">""</span>);
				text = text.replace(<span class="hljs-regexp">/\{\{(.*?)\}\}/g</span>, <span class="hljs-string">"',$1,'"</span>);
				text = text.split(<span class="hljs-string">"{%"</span>).join(<span class="hljs-string">"');"</span>);
				text = text.split(<span class="hljs-string">"%}"</span>).join(<span class="hljs-string">"a.push('"</span>);
				text = <span class="hljs-string">"var a=[];a.push('"</span> + text + <span class="hljs-string">"');return a.join('');"</span>;

				<span class="hljs-keyword">this</span>.range = <span class="hljs-built_in">document</span>.createRange();
				<span class="hljs-keyword">this</span>.source = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(text);
			}},</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>This returns a HTML string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			render: { value: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
				<span class="hljs-keyword">this</span>.range.selectNode(<span class="hljs-built_in">document</span>.body);
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.range.createContextualFragment(<span class="hljs-keyword">this</span>.source.call(d));
			}}
		}),</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p><em>Base</em> element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		extends: <span class="hljs-string">"template"</span>
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <h2 id="hb-collection">HB.Collection</h2>

            </div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Same treatment for <code>HB.Collection</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> Collection = HB.Collection = <span class="hljs-built_in">document</span>.registerElement(<span class="hljs-string">"hb-collection"</span>, {
		prototype: clone(HTMLElement.prototype, {</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>This method turns JSON into children.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			load: { value: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
				<span class="hljs-keyword">this</span>.id = data.id;
				<span class="hljs-keyword">this</span>.handle = data.handle;
				<span class="hljs-keyword">this</span>.title = data.title;
				<span class="hljs-keyword">this</span>.description = data.description;
				<span class="hljs-keyword">this</span>.type = data.type;
				<span class="hljs-keyword">this</span>.url = data.url;

				<span class="hljs-keyword">this</span>.template = <span class="hljs-built_in">window</span>[data.type] ||
								<span class="hljs-built_in">window</span>.collection ||
								<span class="hljs-built_in">window</span>.default;

				<span class="hljs-keyword">this</span>.blocks = data.blocks.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Block(data);
				});

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.template.dataset.sort !== <span class="hljs-literal">undefined</span>) {
					<span class="hljs-keyword">this</span>.sort(<span class="hljs-keyword">this</span>.template.dataset.sort);
					<span class="hljs-keyword">return</span>;
				}

				<span class="hljs-keyword">this</span>.update();
			}},</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Suppress error spam.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			id: {
				get: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._id; },
				set: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
					<span class="hljs-keyword">this</span>._id = value;
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Fix tooltip.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			title: {
				get: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._title; },
				set: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
					<span class="hljs-keyword">this</span>._title = value;
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>This getter/setter gets/sets the current shown <strong>block</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			block: {
				get: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._block; },
				set: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
					<span class="hljs-keyword">this</span>._block = value;

					<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.blocks !== <span class="hljs-literal">undefined</span>) {
						<span class="hljs-keyword">this</span>.update();
					}
				}
			},</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Sorts <code>blocks</code> by <code>by</code> and updates the <strong>collection</strong>.
Uses <strong>block</strong> <code>reduce</code>,
and if <code>by</code> starts with a <code>-</code>, guess what?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			sort: { value: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">by</span>) </span>{
				<span class="hljs-keyword">var</span> order = by[<span class="hljs-number">0</span>] === <span class="hljs-string">"-"</span> ?
					(by = by.substr(<span class="hljs-number">1</span>), <span class="hljs-number">-1</span>) : <span class="hljs-number">1</span>;

				<span class="hljs-keyword">this</span>.blocks.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>{
					a = a.reduce(by);
					b = b.reduce(by);

					<span class="hljs-keyword">return</span> (a &lt; b ? <span class="hljs-number">-1</span> : a &gt; b ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>) * order;
				});

				<span class="hljs-keyword">this</span>.update();
			}},</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>This returns a clone of the <strong>collection</strong> with found <code>blocks</code>.
Uses <strong>block</strong> <code>reduce</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			search: { value: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, value</span>) </span>{
				<span class="hljs-keyword">var</span> data = clone(<span class="hljs-keyword">this</span>);

				data.blocks = data.blocks.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">block</span>) </span>{
					<span class="hljs-keyword">return</span> block.reduce(key) === value;
				});

				<span class="hljs-keyword">return</span> data;
			}},</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Updates the <strong>collection</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			update: { value: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Figure out what to use as <code>data</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>._block === <span class="hljs-literal">undefined</span> ?
					<span class="hljs-keyword">this</span> : <span class="hljs-keyword">this</span>.search(<span class="hljs-string">"handle"</span>, <span class="hljs-keyword">this</span>._block);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Object to give to the <code>update</code> event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> d = {
					id: <span class="hljs-keyword">this</span>.id,
					handle: <span class="hljs-keyword">this</span>.handle,
					title: <span class="hljs-keyword">this</span>.title,
					type: <span class="hljs-keyword">this</span>.type,
					template: <span class="hljs-keyword">this</span>.template
				};</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Checks if <code>block</code> is defined so it can show <em>subpage</em>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._block !== <span class="hljs-literal">undefined</span>) {
					<span class="hljs-keyword">var</span> block = data.blocks[<span class="hljs-number">0</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>If so, but not found, go back to start.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> (block === <span class="hljs-literal">undefined</span>) {
						<span class="hljs-keyword">return</span> (location.hash = <span class="hljs-string">"#!/"</span> + <span class="hljs-keyword">this</span>.handle);
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Change event object to match <strong>block</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					d = {
						id: block.id,
						handle: block.handle,
						title: block.title,
						type: block.type,
						template: block.template
					};
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Halt if needed <strong>template</strong> isnâ€™t defined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> (d.template === <span class="hljs-literal">undefined</span>) {
					<span class="hljs-keyword">var</span> error = <span class="hljs-string">"Template #{} is not defined"</span>.format(d.type);
					<span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(error);
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Remove existing children.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">while</span> (<span class="hljs-keyword">this</span>.firstChild) {
					<span class="hljs-keyword">this</span>.removeChild(<span class="hljs-keyword">this</span>.firstChild);
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Turn HTML generated by <strong>template</strong> <code>render</code> into children.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">this</span>.appendChild(d.template.render(data));</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Fire the event <code>update</code> when the <strong>collection</strong> updates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">this</span>.dispatchEvent(<span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">"update"</span>, { detail: d }));
			}}
		})
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <h2 id="hb-block">HB.Block</h2>

            </div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
	<span class="hljs-keyword">var</span> Block = HB.Block = klass({</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Not much to tellâ€¦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">constructor</span>: function Block(data) {
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> data) {
				<span class="hljs-keyword">this</span>[key] = data[key];
			}

			<span class="hljs-keyword">this</span>.time = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(data.time);

			<span class="hljs-keyword">this</span>.template = <span class="hljs-built_in">window</span>[data.type] ||
							<span class="hljs-built_in">window</span>.block ||
							<span class="hljs-built_in">window</span>.default;
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Returns the value of a property. Like <code>attributes.example</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		reduce: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">to</span>) </span>{
			<span class="hljs-keyword">var</span> find = to.split(<span class="hljs-string">"."</span>),
				result = <span class="hljs-keyword">this</span>[find[<span class="hljs-number">0</span>]];

			<span class="hljs-keyword">if</span> (find[<span class="hljs-number">1</span>] !== <span class="hljs-literal">undefined</span>) {
				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; find.length; i++) {
					result = result[find[i]];
				}
			}

			<span class="hljs-keyword">return</span> result;
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <h2 id="router">Router</h2>

            </div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
	<span class="hljs-keyword">var</span> Router = HB.Router = klass({</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p><em>Constructor</em> sets up a listener for hash changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">constructor</span>: function Router(fallback) {
			<span class="hljs-keyword">this</span>.fallback = fallback || <span class="hljs-literal">null</span>;

			<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">"hashchange"</span>, <span class="hljs-keyword">this</span>.match.bind(<span class="hljs-keyword">this</span>));
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Adds the <code>route</code> with corresponding <code>callback</code> to the router.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		add$hidden: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">route, callback</span>) </span>{
			<span class="hljs-keyword">var</span> id = route,
				opt = <span class="hljs-regexp">/\((\/:[a-z]+)\)\?/g</span>;

			<span class="hljs-keyword">if</span> (opt.test(route)) {
				route = route.replace(opt, <span class="hljs-string">"(?:$1)?"</span>);
			}

			<span class="hljs-keyword">var</span> regExp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(route.replace(<span class="hljs-regexp">/:[a-z]+/g</span>, <span class="hljs-string">"([a-z0-9-]+)"</span>), <span class="hljs-string">"i"</span>);

			<span class="hljs-keyword">this</span>[id] = callback;
			<span class="hljs-keyword">this</span>[id].regExp = regExp;
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>This gets called when <code>location.hash</code> changes,
and tries to do something with the defined routes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		match$hidden: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> fallback = <span class="hljs-literal">true</span>;

			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>) {
				<span class="hljs-keyword">if</span> (i === <span class="hljs-string">"fallback"</span>) {
					<span class="hljs-keyword">continue</span>;
				}

				<span class="hljs-keyword">var</span> matches = location.hash.match(<span class="hljs-keyword">this</span>[i].regExp);

				<span class="hljs-keyword">if</span> (matches !== <span class="hljs-literal">null</span>) {
					matches.shift();

					<span class="hljs-keyword">this</span>[i].apply(<span class="hljs-keyword">this</span>, matches);

					fallback = <span class="hljs-literal">false</span>;
				}
			}

			<span class="hljs-keyword">if</span> (fallback &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.fallback === <span class="hljs-string">"function"</span>) {
				<span class="hljs-keyword">this</span>.fallback();
			}
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Add the <code>HB.Router</code> <em>class</em> to the top-level namespace.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	HB.router = <span class="hljs-keyword">new</span> Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <h2 id="request">Request</h2>

            </div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
	<span class="hljs-keyword">var</span> Request = HB.Request = klass({</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Sets up <code>XMLHttpRequest</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">constructor</span>: function Request(endpoint) {
			<span class="hljs-keyword">this</span>.endpoint = endpoint;

			<span class="hljs-keyword">this</span>.xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();
			<span class="hljs-keyword">this</span>.xhr.addEventListener(<span class="hljs-string">"load"</span>, <span class="hljs-keyword">this</span>.load.bind(<span class="hljs-keyword">this</span>));
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Do a <code>prop.method</code> request to <code>this.endpoint</code> (formats with <code>prop</code>).
Can send <code>prop.data</code> as <code>prop.type</code> (defaults to <code>application/json</code>).
Accepts <code>prop.accept</code> (defaults to <code>application/json</code>).
Returns data as <code>prop.response</code> (defaults to <code>json</code>).
Calls <code>prop.success</code> if all good, else <code>prop.error</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		send: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">prop</span>) </span>{
			<span class="hljs-keyword">var</span> method = prop.method,

				accept = prop.accept || <span class="hljs-string">"application/json"</span>,
				response = prop.response || <span class="hljs-string">"json"</span>,
				data = prop.data || <span class="hljs-literal">null</span>;

			html.classList.add(<span class="hljs-string">"loading"</span>);

			<span class="hljs-keyword">this</span>.success = prop.success;
			<span class="hljs-keyword">this</span>.error = prop.error;

			<span class="hljs-keyword">this</span>.xhr.open(method, <span class="hljs-keyword">this</span>.endpoint.format(prop));
			<span class="hljs-keyword">this</span>.xhr.responseType = response;
			<span class="hljs-keyword">this</span>.xhr.setRequestHeader(<span class="hljs-string">"Accept"</span>, accept);

			<span class="hljs-keyword">if</span> (method !== <span class="hljs-string">"GET"</span> &amp;&amp; data !== <span class="hljs-literal">null</span>) {
				<span class="hljs-keyword">var</span> type = prop.type || <span class="hljs-string">"application/json"</span>;

				<span class="hljs-keyword">this</span>.xhr.setRequestHeader(<span class="hljs-string">"Content-Type"</span>, type);

				<span class="hljs-keyword">if</span> (type === <span class="hljs-string">"application/json"</span>) {
					data = <span class="hljs-built_in">JSON</span>.stringify(data);
				}
			}

			<span class="hljs-keyword">this</span>.xhr.send(data);
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Shorthand for GET request.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		get: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">prop</span>) </span>{
			prop.method = <span class="hljs-string">"GET"</span>;
			<span class="hljs-keyword">this</span>.send(prop);
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Response to JSON.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		load: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">try</span> {
				<span class="hljs-keyword">var</span> data = <span class="hljs-keyword">this</span>.xhr.response;

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.xhr.status === <span class="hljs-number">200</span>) {
					<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.success === <span class="hljs-string">"function"</span>) {
						<span class="hljs-keyword">this</span>.success(data);
					}
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.error === <span class="hljs-string">"function"</span>) {
					<span class="hljs-keyword">this</span>.error(data);
				}
			} <span class="hljs-keyword">catch</span> (e) {
				e.status = <span class="hljs-number">-1</span>;

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.error === <span class="hljs-string">"function"</span>) {
					<span class="hljs-keyword">this</span>.error(e);
					<span class="hljs-keyword">return</span>;
				}

				<span class="hljs-built_in">console</span>.error(e);
			} <span class="hljs-keyword">finally</span> {
				html.classList.remove(<span class="hljs-string">"loading"</span>);
			}
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <h2 id="helpers">Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Formats a string (<code>:param</code> or <code>{n}</code> and/or <code>{}</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-built_in">String</span>.prototype.format = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
		<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data !== <span class="hljs-string">"object"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p><code>Array.apply</code> doesnâ€™t work on <em>arrays</em> with a single number.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			data = [].slice.call(<span class="hljs-built_in">arguments</span>);
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.replace(<span class="hljs-regexp">/:([a-z]+)|\{([0-9])?\}/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$0, $1, $2</span>) </span>{
			<span class="hljs-keyword">return</span> data[$<span class="hljs-number">1</span> || $<span class="hljs-number">2</span> || i++];
		});
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Itâ€™s kinda like <code>date</code> in PHP.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-built_in">Date</span>.prototype.format = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">spec</span>) </span>{
		<span class="hljs-keyword">var</span> ords = <span class="hljs-built_in">Date</span>.ordinals,
			days = <span class="hljs-built_in">Date</span>.days,
			months = <span class="hljs-built_in">Date</span>.months,

			date = <span class="hljs-keyword">this</span>.getDate(),
			day = <span class="hljs-keyword">this</span>.getDay(),
			month = <span class="hljs-keyword">this</span>.getMonth(),
			year = <span class="hljs-keyword">this</span>.getFullYear(),
			hours = <span class="hljs-keyword">this</span>.getHours(),
			twelve = (hours % <span class="hljs-number">12</span>) || <span class="hljs-number">12</span>,
			minutes = <span class="hljs-keyword">this</span>.getMinutes(),
			seconds = <span class="hljs-keyword">this</span>.getSeconds();

		<span class="hljs-keyword">var</span> options = {
			d: date &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">"0"</span> + date : date,
			D: days[day].substr(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>),
			j: date,
			l: days[day],
			N: day || <span class="hljs-number">7</span>,
			S: date &gt; <span class="hljs-number">3</span> &amp;&amp; date &lt;= <span class="hljs-number">20</span> ? ords[<span class="hljs-number">0</span>] : (ords[date % <span class="hljs-number">10</span>] || ords[<span class="hljs-number">0</span>]),
			w: day,
			F: months[month],
			m: month &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">"0"</span> + (month + <span class="hljs-number">1</span>) : (month + <span class="hljs-number">1</span>),
			M: months[month].substr(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>),
			n: month + <span class="hljs-number">1</span>,
			t: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(year, month + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>).getDate(),
			Y: year,
			y: (<span class="hljs-string">""</span> + year).substr(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>),
			a: hours &lt; <span class="hljs-number">12</span> ? <span class="hljs-string">"am"</span> : <span class="hljs-string">"pm"</span>,
			A: hours &lt; <span class="hljs-number">12</span> ? <span class="hljs-string">"AM"</span> : <span class="hljs-string">"PM"</span>,
			g: twelve,
			G: hours,
			h: twelve &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">"0"</span> + twelve : twelve,
			H: hours &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">"0"</span> + hours : hours,
			i: minutes &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">"0"</span> + minutes : minutes,
			s: seconds &lt; <span class="hljs-number">10</span> ? <span class="hljs-string">"0"</span> + seconds : seconds
		};

		<span class="hljs-keyword">return</span> spec.replace(<span class="hljs-regexp">/\\?([a-z])/gi</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$0, $1</span>) </span>{
			<span class="hljs-keyword">return</span> options[$<span class="hljs-number">0</span>] !== <span class="hljs-literal">undefined</span> ? options[$<span class="hljs-number">0</span>] : $<span class="hljs-number">1</span>;
		});
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Text strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-built_in">Date</span>.ordinals = [<span class="hljs-string">"th"</span>, <span class="hljs-string">"st"</span>, <span class="hljs-string">"nd"</span>, <span class="hljs-string">"rd"</span>];

	<span class="hljs-built_in">Date</span>.days = [
		<span class="hljs-string">"Sunday"</span>,
		<span class="hljs-string">"Monday"</span>,
		<span class="hljs-string">"Tuesday"</span>,
		<span class="hljs-string">"Wednesday"</span>,
		<span class="hljs-string">"Thursday"</span>,
		<span class="hljs-string">"Friday"</span>,
		<span class="hljs-string">"Saturday"</span>
	];

	<span class="hljs-built_in">Date</span>.months = [
		<span class="hljs-string">"January"</span>,
		<span class="hljs-string">"February"</span>,
		<span class="hljs-string">"March"</span>,
		<span class="hljs-string">"April"</span>,
		<span class="hljs-string">"May"</span>,
		<span class="hljs-string">"June"</span>,
		<span class="hljs-string">"July"</span>,
		<span class="hljs-string">"August"</span>,
		<span class="hljs-string">"September"</span>,
		<span class="hljs-string">"October"</span>,
		<span class="hljs-string">"November"</span>,
		<span class="hljs-string">"December"</span>
	];</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p><code>dataset</code> polyfill.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> (html.dataset === <span class="hljs-literal">undefined</span>) {
		define(HTMLElement.prototype, <span class="hljs-string">"dataset"</span>, {
			get: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">var</span> dataset = {},
					attributes = <span class="hljs-keyword">this</span>.attributes;

				<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; attributes.length; i++) {
					<span class="hljs-keyword">var</span> name = attributes[i].name.split(<span class="hljs-string">"-"</span>);

					<span class="hljs-keyword">if</span> (name[<span class="hljs-number">1</span>] !== <span class="hljs-literal">undefined</span> &amp;&amp; name[<span class="hljs-number">0</span>] === <span class="hljs-string">"data"</span>) {
						dataset[name[<span class="hljs-number">1</span>]] = attributes[i].value;
					}
				}

				<span class="hljs-keyword">return</span> dataset;
			}
		});
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p><code>CustomEvent</code> polyfill.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> (isTrident(<span class="hljs-number">7</span>)) {
		<span class="hljs-built_in">window</span>.CustomEvent = Event.extend({
			<span class="hljs-keyword">constructor</span>: function CustomEvent(type, props) {
				<span class="hljs-keyword">var</span> event = <span class="hljs-built_in">document</span>.createEvent(<span class="hljs-string">"CustomEvent"</span>);

				event.initCustomEvent(type, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, props.detail);

				<span class="hljs-keyword">return</span> event;
			}
		});
	}
})(<span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
