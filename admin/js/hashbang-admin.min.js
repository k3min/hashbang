(function(d){var k=d.document,h=d.location,g=k.documentElement,b=d.HA={version:"0.0.6",endpoint:"api/",valid:/image\/(jpeg|png|svg\+xml)/,main:function(){b.dialog=d.dialog;b.request=new HB.Request(b.endpoint);b.request.get({success:b.sync,error:b.error});b.upload.init()},update:function(){var a=k.querySelector("textarea");null!==a&&a.addEventListener("keydown",b.textarea,!1)},textarea:function(a){var c=!1;switch(a.keyCode){case b.KEY.S:if(!a.metaKey&&!a.ctrlKey)break;c=new CustomEvent("change",{detail:this});
HB.root.dispatchEvent(c);c=!0;break;case b.KEY.TAB:var c=this.selectionStart,e=this.selectionEnd,d=this.value;this.value=d.slice(0,c)+"\t"+d.slice(e);this.selectionStart=this.selectionEnd=c+1;c=!0}c&&a.preventDefault()},block:{target:null,init:function(a){var c=a.querySelectorAll("dt");a=a.querySelectorAll("dd");for(var e=0;e<c.length;e++){var d=c[e];d.addEventListener("dragenter",b.block.enter,!1);d.addEventListener("dragover",b.block.drag,!1);d.addEventListener("dragleave",b.block.leave,!1);d.addEventListener("drop",
b.block.drop,!1)}for(e=0;e<a.length;e++)c=a[e],c.addEventListener("dragstart",b.block.start,!1),c.addEventListener("dragend",b.block.end,!1)},start:function(a){a.dataTransfer.effectAllowed="move";b.block.target=this;g.classList.add("move")},end:function(){b.block.target=null;g.classList.remove("move")},enter:function(){null!==b.block.target&&this.classList.add("target")},leave:function(){null!==b.block.target&&this.classList.remove("target")},drag:function(a){null!==b.block.target&&(a.preventDefault(),
a.dataTransfer.dropEffect="move")},drop:function(a){null!==b.block.target&&(b.request.send({method:"POST",success:b.sync,error:b.error,data:{type:"block",id:b.block.target.dataset.id,key:"collectionId",value:this.dataset.id}}),b.block.leave.call(this),a.preventDefault())}},upload:{init:function(){d.addEventListener("dragenter",b.upload.enter,!1);d.addEventListener("dragend",b.upload.end,!1);d.upload.addEventListener("dragenter",b.upload.drag,!1);d.upload.addEventListener("dragover",b.upload.drag,
!1);d.upload.addEventListener("dragleave",b.upload.leave,!1);d.upload.addEventListener("drop",b.upload.drop,!1)},enter:function(a){a=a.target;a===d.upload&&a.classList.add("target");g.classList.add("upload")},leave:function(){d.upload.classList.remove("target")},end:function(a){b.upload.leave();g.classList.remove("upload");a.preventDefault()},drag:function(a){b.upload.enter(a);a.dataTransfer.dropEffect="copy";a.preventDefault();a.stopPropagation()},drop:function(a){var c=a.dataTransfer.files;if(0<
c.length&&b.valid.test(c[0].type)){var e=new FileReader;e.addEventListener("load",b.put,!1);e.readAsDataURL(c[0])}b.upload.end(a)}},create:function(a,c){var e={type:a};switch(a){case b.TYPE.COLLECTION:case b.TYPE.TAG:case b.TYPE.ATTRIBUTE:e.key="handle";e.value="new-{}".format(a);break;case b.TYPE.BLOCK:e.key="collectionId",e.value=c}b.request.send({method:"POST",success:b.sync,error:b.error,data:e})},sync:function(a){var c=d.overview,e=d.tags,l=d.attributes;b.metadata={attributes:a.attributes,collections:a.collections,
tags:a.tags,images:a.images};c.replaceChildren(d.nav.render(a.collections));e.replaceChildren(d.datalist.render(a.tags));l.replaceChildren(d.datalist.render(a.attributes));b.block.init(c);void 0===HB.root&&(HB.noCache=!0,HB.main(),HB.root.addEventListener("update",b.update,!1),HB.root.addEventListener("change",b.save,!1));null!==a.target&&(!0===a.target?d.dispatchEvent(new Event("hashchange")):h.hash=a.target)},save:function(a){a=a.detail||a.target;var c=a.dataset,e=c.type,c=+c.id,d=a.name,f=a.value;
if(""!==d&&a.validity.valid){switch(e){case b.TYPE.TAG:case b.TYPE.ATTRIBUTE:if("handle"===d&&""===f)return b["delete"](e,c,-1);break;case b.TYPE.BLOCK_TAG:case b.TYPE.BLOCK_ATTRIBUTE:if(!a.checked)return b["delete"](e,c,f)}b.request.send({method:"POST",success:b.sync,error:b.error,data:{type:e,id:c,key:d,value:f}})}},"delete":function(a,c,e){if(-1===e)return b.dialog.render(b.message["delete"],{type:a,id:c});a===b.TYPE.IMAGE&&(a+="/"+{jpg:"jpeg",png:"png",svg:"svg+xml"}[c.split(".").pop()]);b.request.send({method:"DELETE",
success:b.sync,error:b.error,data:{type:a,id:c,value:e}})},put:function(a){a=this.result;b.request.send({method:"PUT",success:b.sync,error:b.error,data:{type:a.match(b.valid)[0],value:a.split(",")[1]}})},error:function(a){g.classList.add("error");b.dialog.render(b.message[a.status]||b.message.error)},logout:function(){b.request.error=null;b.request.xhr.open("HEAD",":protocol//logout@:host:port:pathname".format(h)+b.endpoint);b.request.xhr.send();h.reload(!0)},TYPE:{COLLECTION:"collection",BLOCK:"block",
TAG:"tag",ATTRIBUTE:"attribute",BLOCK_TAG:"blockTag",BLOCK_ATTRIBUTE:"blockAttribute",IMAGE:"image"},KEY:{TAB:9,ESC:27,S:83},message:{"delete":{title:"Are you sure you want to delete this :type?",description:"This action cannot be undone!",buttons:[{title:"Cancel",action:!1},{title:"OK",action:!0}]},error:{title:"Something went wrong!",description:"Please try again.",buttons:[{title:"Reload",action:!0},{title:"OK",action:!1}]},400:{title:"Something went seriously wrong!"},401:{title:"You are not authorized!"},
500:{title:"Something went wrong on the server!"}}};k.registerElement("ha-dialog",{prototype:Object.create(HTMLDialogElement.prototype,{attachedCallback:{value:function(){this.addEventListener("close",this.callback,!1);d.addEventListener("keydown",this.keys.bind(this),!1)}},render:{value:function(a,c){a=Object.create(a);if(void 0!==a.buttons){var e=b.message,l=Object.keys(e);void 0===c&&(c={});for(var f in l){var g=l[f];if(e[g].title===a.title){c.action=g;break}}a.title=a.title.format(c);a.data=JSON.stringify(c).replace(/"/g,
"\\'")}this.replaceChildren(d.message.render(a));this.show()}},callback:{value:function(){var a=this.returnValue.replace(/\'/g,'"');if(""!==a&&(a=JSON.parse(a),void 0!==a.action))switch(a.action){case "delete":b["delete"](a.type,a.id);break;case "error":h.reload(!0)}}},keys:{value:function(a){var c=!1;if(this.open){switch(a.keyCode){case b.KEY.ESC:this.close();c=!0;break;case b.KEY.TAB:var e=a.target,d=a.shiftKey,f=this.querySelectorAll("button"),g=f[0],f=f[f.length-1],h=e===k.body;e!==f&&!h||d?(e===
g||h)&&d&&(f.focus(),c=!0):(g.focus(),c=!0)}c&&a.preventDefault()}}}}),"extends":"dialog"});Object.defineProperty(Object.prototype,"has",{value:function(a){for(var b in this)if(a.handle===b&&a.title===this[b])return!0;return!1}})})(this);
