(function(e){var k=e.document,m=e.location,f=k.documentElement,b=e.HA={version:"0.0.5",endpoint:"api/",valid:/image\/(jpeg|png|svg\+xml)/,main:function(){b.request=new HB.Request(b.endpoint);b.request.get({success:b.sync,error:b.error});b.upload.init();b.dialog.init()},update:function(){var a=k.querySelector("textarea");null!==a&&a.addEventListener("keydown",b.textarea,!1)},textarea:function(a){var c=!1;switch(a.keyCode){case b.KEY.S:if(!a.metaKey&&!a.ctrlKey)break;c=new CustomEvent("change",{detail:this});
HB.root.dispatchEvent(c);c=!0;break;case b.KEY.TAB:var c=this.selectionStart,d=this.selectionEnd,e=this.value;this.value=e.slice(0,c)+"\t"+e.slice(d);this.selectionStart=this.selectionEnd=c+1;c=!0}c&&a.preventDefault()},block:{target:null,init:function(a){var c=a.querySelectorAll("dt");a=a.querySelectorAll("dd");for(var d=0;d<c.length;d++){var e=c[d];e.addEventListener("dragenter",b.block.enter,!1);e.addEventListener("dragover",b.block.drag,!1);e.addEventListener("dragleave",b.block.leave,!1);e.addEventListener("drop",
b.block.drop,!1)}for(d=0;d<a.length;d++)c=a[d],c.addEventListener("dragstart",b.block.start,!1),c.addEventListener("dragend",b.block.end,!1)},start:function(a){a.dataTransfer.effectAllowed="move";b.block.target=this;f.classList.add("move")},end:function(){b.block.target=null;f.classList.remove("move")},enter:function(){null!==b.block.target&&this.classList.add("target")},leave:function(){null!==b.block.target&&this.classList.remove("target")},drag:function(a){null!==b.block.target&&(a.preventDefault(),
a.dataTransfer.dropEffect="move")},drop:function(a){null!==b.block.target&&(b.request.send({method:"POST",success:b.sync,error:b.error,data:{type:"block",id:b.block.target.dataset.id,key:"collectionId",value:this.dataset.id}}),b.block.leave.call(this),a.preventDefault())}},upload:{init:function(){e.addEventListener("dragenter",b.upload.enter,!1);e.addEventListener("dragend",b.upload.end,!1);e.upload.addEventListener("dragenter",b.upload.drag,!1);e.upload.addEventListener("dragover",b.upload.drag,
!1);e.upload.addEventListener("dragleave",b.upload.leave,!1);e.upload.addEventListener("drop",b.upload.drop,!1)},enter:function(a){a=a.target;a===e.upload&&a.classList.add("target");f.classList.add("upload")},leave:function(){e.upload.classList.remove("target")},end:function(a){b.upload.leave();f.classList.remove("upload");a.preventDefault()},drag:function(a){b.upload.enter(a);a.dataTransfer.dropEffect="copy";a.preventDefault();a.stopPropagation()},drop:function(a){var c=a.dataTransfer.files;if(0<
c.length&&b.valid.test(c[0].type)){var d=new FileReader;d.addEventListener("load",b.put,!1);d.readAsDataURL(c[0])}b.upload.end(a)}},create:function(a,c){var d={type:a};switch(a){case b.TYPE.COLLECTION:case b.TYPE.TAG:case b.TYPE.ATTRIBUTE:d.key="handle";d.value="new-{}".format(a);break;case b.TYPE.BLOCK:d.key="collectionId",d.value=c}b.request.send({method:"POST",success:b.sync,error:b.error,data:d})},sync:function(a){var c=e.overview,d=e.tags,l=e.attributes;b.metadata={attributes:a.attributes,collections:a.collections,
tags:a.tags,images:a.images};c.replaceChildren(e.nav.render(a.collections));d.replaceChildren(e.datalist.render(a.tags));l.replaceChildren(e.datalist.render(a.attributes));b.block.init(c);void 0===HB.root&&(HB.noCache=!0,HB.main(),HB.root.addEventListener("update",b.update,!1),HB.root.addEventListener("change",b.save,!1));null!==a.target&&(!0===a.target?e.dispatchEvent(new Event("hashchange")):m.hash=a.target)},save:function(a){a=a.detail||a.target;var c=a.dataset,d=c.type,c=+c.id,e=a.name,g=a.value;
if(""!==e&&a.validity.valid){switch(d){case b.TYPE.TAG:case b.TYPE.ATTRIBUTE:if("handle"===e&&""===g)return b["delete"](d,c,-1);break;case b.TYPE.BLOCK_TAG:case b.TYPE.BLOCK_ATTRIBUTE:if(!a.checked)return b["delete"](d,c,g)}b.request.send({method:"POST",success:b.sync,error:b.error,data:{type:d,id:c,key:e,value:g}})}},"delete":function(a,c,d){if(-1===d)return b.dialog.show(b.strings["delete"],{type:a,id:c});a===b.TYPE.IMAGE&&(a+="/"+{jpg:"jpeg",png:"png",svg:"svg+xml"}[c.split(".").pop()]);b.request.send({method:"DELETE",
success:b.sync,error:b.error,data:{type:a,id:c,value:d}})},put:function(a){a=this.result;b.request.send({method:"PUT",success:b.sync,error:b.error,data:{type:a.match(b.valid)[0],value:a.split(",")[1]}})},error:function(a){f.classList.add("error");b.dialog.show(b.strings[a.status]||b.strings.error)},dialog:{init:function(){e.addEventListener("keydown",b.dialog.keys,!1);e.dialog.addEventListener("close",b.dialog.close,!1)},show:function(a,c){var d=e.dialog;if(void 0!==c){var l=b.strings,g=Object.keys(l),
h;for(h in g){var f=g[h];if(l[f].title===a.title){c.action=f;break}}a.title=a.title.format(c);a.data=JSON.stringify(c).replace(/"/g,"'")}d.replaceChildren(e.message.render(a));d.show()},close:function(a){a=this.returnValue;if(null!==a&&void 0!==a.action)switch(a.action){case "delete":b["delete"](a.type,a.id)}},keys:function(a){var c=!1,d=e.dialog;if(d.open){switch(a.keyCode){case b.KEY.ESC:d.close();c=!0;break;case b.KEY.TAB:var f=a.target,g=a.shiftKey,h=d.querySelectorAll("button"),d=h[0],h=h[h.length-
1];f===h&&!g||f===k.body?(d.focus(),c=!0):f===d&&g&&(h.focus(),c=!0)}c&&a.preventDefault()}},TYPE:{DELETE:0}},logout:function(){b.request.error=null;b.request.xhr.open("HEAD",":protocol//logout@:host:port:pathname".format(m)+b.endpoint);b.request.xhr.send();m.reload(!0)},TYPE:{COLLECTION:"collection",BLOCK:"block",TAG:"tag",ATTRIBUTE:"attribute",BLOCK_TAG:"blockTag",BLOCK_ATTRIBUTE:"blockAttribute",IMAGE:"image"},KEY:{TAB:9,ESC:27,S:83},strings:{"delete":{title:"Are you sure you want to delete this :type?",
description:"This action cannot be undone!"},error:{title:"Something went wrong!",description:"Please try again."},400:{title:"Something went seriously wrong!"},401:{title:"You are not authorized!"},500:{title:"Something went wrong on the server!"}}};Object.defineProperty(Object.prototype,"has",{value:function(a){for(var b in this)if(a.handle===b&&a.title===this[b])return!0;return!1}});void 0===e.HTMLDialogElement&&(e.HTMLDialogElement=HTMLElement.extend({constructor:function(){console.error("Illegal constructor")}}),
k.registerElement("dialog",{prototype:Object.create(HTMLElement.prototype,{returnValue:{writable:!0,value:null},open:{get:function(){return"open"===this.getAttribute("open")},set:function(a){a?this.setAttribute("open","open"):this.removeAttribute("open")}},show:{value:function(){this.returnValue=null;this.open=!0}},close:{value:function(a){void 0!==a&&(this.returnValue=a);this.dispatchEvent(new CustomEvent("close"));this.open=!1}}})}))})(this);