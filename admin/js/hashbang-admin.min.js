(function(c){var h=c.document,k=c.location,f=h.documentElement,b=c.HA={version:"0.0.3",endpoint:"api/",valid:/image\/(jpeg|png|svg\+xml)/,main:function(){b.request=new HB.Request(b.endpoint);b.request.get({success:b.sync,error:b.error});b.upload.init()},update:function(){var a=h.querySelector("textarea");null!==a&&a.addEventListener("keydown",b.keys,!1)},keys:function(a){var b=!1;switch(a.keyCode){case 83:if(a.metaKey||a.ctrlKey)b=new CustomEvent("change",{detail:this}),HB.root.dispatchEvent(b),b=
!0;break;case 9:var b=this.selectionStart,d=this.selectionEnd,c=this.value;this.value=c.slice(0,b)+"\t"+c.slice(d);this.selectionStart=this.selectionEnd=b+1;b=!0}b&&a.preventDefault()},block:{target:null,init:function(a){var e=a.querySelectorAll("dt");a=a.querySelectorAll("dd");for(var d=0;d<e.length;d++){var c=e[d];c.addEventListener("dragenter",b.block.enter,!1);c.addEventListener("dragover",b.block.drag,!1);c.addEventListener("dragleave",b.block.leave,!1);c.addEventListener("drop",b.block.drop,
!1)}for(d=0;d<a.length;d++)e=a[d],e.addEventListener("dragstart",b.block.start,!1),e.addEventListener("dragend",b.block.end,!1)},start:function(a){a.dataTransfer.effectAllowed="move";b.block.target=this;f.classList.add("move")},end:function(){b.block.target=null;f.classList.remove("move")},enter:function(){null!==b.block.target&&this.classList.add("target")},leave:function(){null!==b.block.target&&this.classList.remove("target")},drag:function(a){null!==b.block.target&&(a.preventDefault(),a.dataTransfer.dropEffect=
"move")},drop:function(a){null!==b.block.target&&(b.request.send({method:"POST",data:{type:"block",id:b.block.target.dataset.id,key:"collectionId",value:this.dataset.id}}),b.block.leave.call(this),a.preventDefault())}},upload:{init:function(){c.addEventListener("dragenter",b.upload.enter,!1);c.addEventListener("dragend",b.upload.end,!1);c.upload.addEventListener("dragenter",b.upload.drag,!1);c.upload.addEventListener("dragover",b.upload.drag,!1);c.upload.addEventListener("dragleave",b.upload.leave,
!1);c.upload.addEventListener("drop",b.upload.drop,!1)},enter:function(a){a=a.target;a===c.upload&&a.classList.add("target");f.classList.add("upload")},leave:function(){c.upload.classList.remove("target")},end:function(a){b.upload.leave();f.classList.remove("upload");a.preventDefault()},drag:function(a){b.upload.enter(a);a.dataTransfer.dropEffect="copy";a.preventDefault();a.stopPropagation()},drop:function(a){var e=a.dataTransfer.files;if(0<e.length&&b.valid.test(e[0].type)){var d=new FileReader;
d.addEventListener("load",b.put,!1);d.readAsDataURL(e[0])}b.upload.end(a)}},create:function(a,e){var d={type:a};switch(a){case b.TYPE.COLLECTION:case b.TYPE.TAG:case b.TYPE.ATTRIBUTE:d.key="handle";d.value="new-{}".format(a);break;case b.TYPE.BLOCK:d.key="collectionId",d.value=e}b.request.send({method:"POST",data:d})},sync:function(a){var e=c.overview,d=c.tags,g=c.attributes;for(b.metadata={attributes:a.attributes,collections:a.collections,tags:a.tags,images:a.images};e.firstChild;)e.removeChild(e.firstChild);
for(;d.firstChild;)d.removeChild(d.firstChild);for(;g.firstChild;)g.removeChild(g.firstChild);e.appendChild(c.nav.render(a.collections));d.appendChild(c.datalist.render(a.tags));g.appendChild(c.datalist.render(a.attributes));b.block.init(e);void 0===HB.root&&(HB.noCache=!0,HB.main(),HB.root.addEventListener("update",b.update,!1),HB.root.addEventListener("change",b.save,!1));null!==a.target&&(!0===a.target?c.dispatchEvent(new Event("hashchange")):k.hash=a.target)},save:function(a){a=a.detail||a.target;
var e=a.dataset,d=e.type,e=+e.id,c=a.name,f=a.value;if(""!==c&&a.validity.valid){switch(d){case b.TYPE.TAG:case b.TYPE.ATTRIBUTE:if("handle"===c&&""===f)return b["delete"](d,e);break;case b.TYPE.BLOCK_TAG:case b.TYPE.BLOCK_ATTRIBUTE:if(!a.checked)return b["delete"](d,e,f)}b.request.send({method:"POST",data:{type:d,id:e,key:c,value:f}})}},"delete":function(a,c,d){if(void 0!==d||confirm(b.strings["delete"].format(a)))a===b.TYPE.IMAGE&&(a+="/"+{jpg:"jpeg",png:"png",svg:"svg+xml"}[c.split(".").pop()]),
b.request.send({method:"DELETE",data:{type:a,id:c,value:d}})},put:function(a){a=a.target.result;b.request.send({method:"PUT",data:{type:a.match(b.valid)[0],value:a.split(",")[1]}})},error:function(a){f.classList.add("error");alert(b.strings[a.status]||b.strings.error)},logout:function(){b.request.error=null;b.request.xhr.open("HEAD",":protocol//logout@:host:port:pathname".format(k)+b.endpoint);b.request.xhr.send()},TYPE:{COLLECTION:"collection",BLOCK:"block",TAG:"tag",ATTRIBUTE:"attribute",BLOCK_TAG:"blockTag",
BLOCK_ATTRIBUTE:"blockAttribute",IMAGE:"image"},strings:{"delete":"Are you sure you want to delete this {}? This action cannot be undone!",error:"Something went wrong!",400:"Something went seriously wrong!",401:"You are not authorized!",500:"Something went wrong on the server!"}};Object.defineProperty(Object.prototype,"has",{value:function(a){for(var b in this)if(a.handle===b&&a.title===this[b])return!0;return!1}});Object.defineProperty(HB.Request.prototype,"send",{value:function(a){f.classList.add("loading");
this.success=b.sync;this.error=b.error;this.xhr.open(a.method,this.endpoint,!0);this.xhr.setRequestHeader("Content-Type","application/json");this.xhr.send(JSON.stringify(a.data))}})})(this);