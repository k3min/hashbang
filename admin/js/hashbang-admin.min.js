(function(c){var e=c.document,l=c.location,h=e.documentElement,b=c.HA={version:"0.0.8",endpoint:"api/",main:function(){b.request=new HB.Request(b.endpoint);b.request.get({success:b.sync,error:b.error});b.upload.init();b.observer=new MutationObserver(b.mutation);c.addEventListener("beforeunload",b.confirm,!1)},mutation:function(){b.changes=!0},confirm:function(){if(b.changes)return"Changes you made may not be saved!"},update:function(){c.toggle.checked=!1},block:{target:null,init:function(a){var d=
a.getElementsByTagName("dt");a=a.getElementsByTagName("dd");for(var f=0;f<d.length;f++){var c=d[f];c.addEventListener("dragenter",b.block.enter,!1);c.addEventListener("dragover",b.block.drag,!1);c.addEventListener("dragleave",b.block.leave,!1);c.addEventListener("drop",b.block.drop,!1)}for(f=0;f<a.length;f++)d=a[f],d.addEventListener("dragstart",b.block.start,!1),d.addEventListener("dragend",b.block.end,!1)},start:function(a){a.dataTransfer.effectAllowed="move";b.block.target=this;h.classList.add("move")},
end:function(){b.block.target=null;h.classList.remove("move")},enter:function(a){null!==b.block.target&&(a.dataTransfer.dropEffect="move",this.classList.add("target"))},leave:function(){null!==b.block.target&&this.classList.remove("target")},drag:function(a){null!==b.block.target&&a.preventDefault()},drop:function(a){null!==b.block.target&&(b.request.send({method:"POST",success:b.sync,error:b.error,data:{type:"block",id:b.block.target.dataset.id,key:"collectionId",value:this.dataset.id}}),b.block.leave.call(this),
a.preventDefault())}},upload:{valid:/image\/(jpeg|png|svg\+xml|gif)/,init:function(){c.addEventListener("dragenter",b.upload.enter,!1);c.addEventListener("dragend",b.upload.end,!1);c.upload.addEventListener("dragenter",b.upload.drag,!1);c.upload.addEventListener("dragover",b.upload.drag,!1);c.upload.addEventListener("dragleave",b.upload.leave,!1);c.upload.addEventListener("drop",b.upload.drop,!1)},enter:function(a){var b=a.target;b!==c.upload?a.dataTransfer.dropEffect="none":(a.dataTransfer.dropEffect=
"copy",b.classList.add("target"));h.classList.add("upload")},leave:function(){c.upload.classList.remove("target")},end:function(a){b.upload.leave();h.classList.remove("upload");a.preventDefault()},drag:function(a){b.upload.enter(a);a.preventDefault();a.stopPropagation()},drop:function(a){b.upload.parse(a.dataTransfer.files);b.upload.end(a)},parse:function(a){if(0!=a.length&&b.upload.valid.test(a[0].type)){var d=new FileReader;d.addEventListener("load",b.put,!1);d.readAsDataURL(a[0])}}},create:function(a,
d){var c={type:a};switch(a){case b.DATA.COLLECTION:case b.DATA.TAG:case b.DATA.ATTRIBUTE:c.key="handle";c.value="new-{}".format(a);break;case b.DATA.BLOCK:c.key="collectionId",c.value=d}b.request.send({method:"POST",success:b.sync,error:b.error,data:c})},sync:function(a){var d=c.overview,f=c.tags,k=c.attributes;b.metadata={attributes:a.attributes,collections:a.collections,tags:a.tags,images:a.images};d.replaceChildren(c.nav.render(a.collections));f.replaceChildren(c.datalist.render(a.tags));k.replaceChildren(c.datalist.render(a.attributes));
b.block.init(d);void 0===HB.root&&(HB.noCache=!0,HB.main(),HB.root.addEventListener("update",b.update,!1),HB.root.addEventListener("change",b.save,!1),HB.root.addEventListener("submit",b.prevent,!1));if(null!==a.target){if(!0===a.target){c.dispatchEvent(new Event("hashchange"));return}l.hash=a.target}b.changes=!1},prevent:function(a){a.preventDefault();a.stopPropagation()},save:function(a){a=a.detail||a.target;var d=a.dataset,c=d.type,d=+d.id,k=a.getAttribute("name"),g=a.value||a.innerHTML,e=a.validity;
if(""!==k&&(void 0===e||e.valid)){switch(c){case b.DATA.TAG:case b.DATA.ATTRIBUTE:if("handle"===k&&""===g)return b["delete"](c,d,-1);break;case b.DATA.BLOCK_TAG:case b.DATA.BLOCK_ATTRIBUTE:if(!a.checked)return b["delete"](c,d,g);break;case b.DATA.IMAGE:b.upload.parse(a.files)}b.request.send({method:"POST",success:b.sync,error:b.error,data:{type:c,id:d,key:k,value:g}})}},"delete":function(a,d,f){if(-1===f)return c.dialog.render(b.message["delete"],{type:a,id:d});a===b.DATA.IMAGE&&(a+="/"+{jpg:"jpeg",
png:"png",svg:"svg+xml",gif:"gif"}[d.split(".").pop()]);b.request.send({method:"DELETE",success:b.sync,error:b.error,data:{type:a,id:d,value:f}})},put:function(a){a=this.result;b.request.send({method:"PUT",success:b.sync,error:b.error,data:{type:a.match(b.upload.valid)[0],value:a.split(",")[1]}})},error:function(a){h.classList.add("error");c.dialog.render(b.message[a.status]||b.message.error)},logout:function(){b.request.error=null;b.request.xhr.open("HEAD",":protocol//logout@:host:port:pathname".format(l)+
b.endpoint);b.request.xhr.send();l.reload(!0)},DATA:{COLLECTION:"collection",BLOCK:"block",TAG:"tag",ATTRIBUTE:"attribute",BLOCK_TAG:"blockTag",BLOCK_ATTRIBUTE:"blockAttribute",IMAGE:"image"},KEY:{TAB:9,ESC:27,S:83,ENTER:13},message:{"delete":{title:"Are you sure you want to delete this :type?",description:"This action cannot be undone!",buttons:[{title:"Cancel"},{title:"OK",action:"delete"}]},error:{title:"Something went wrong!",description:"Please try again.",buttons:[{title:"Reload",action:"reload"},
{title:"OK"}]},createLink:{title:"Create link",placeholder:"http://",buttons:[{title:"Cancel"},{title:"OK",action:"createLink"}]},400:{title:"Something went seriously wrong!"},401:{title:"You are not authorized!"},500:{title:"Something went wrong on the server!"}}};e.registerElement("ha-dialog",{prototype:Object.create(HTMLDialogElement.prototype,{attachedCallback:{value:function(){this.addEventListener("close",this.callback,!1);c.addEventListener("keydown",this.keys.bind(this),!1)}},render:{value:function(a,
b){a=Object.create(a);void 0!==a.buttons&&(void 0===b&&(b={}),a.title=a.title.format(b),a.data=b);this.replaceChildren(c.message.render(a));this.show()}},callback:{value:function(){var a=this.returnValue;if(a){var d=this.getElementsByTagName("input").serialize();switch(a){case "delete":b["delete"](d.type,d.id);break;case "reload":l.reload(!0);break;case "createLink":a=c.getSelection(),d=d.value,a.removeAllRanges(),a.addRange(c.toolbar.range),d?e.execCommand("createLink",!1,d):e.execCommand("unlink",
!1,null)}}}},keys:{value:function(a){var d=!1;if(this.open){switch(a.keyCode){case b.KEY.ESC:this.close();d=!0;break;case b.KEY.TAB:var c=a.target,k=a.shiftKey,g=this.querySelectorAll("button, input:not([type=hidden])"),h=g[0],g=g[g.length-1],l=c===e.body;c!==g&&!l||k?(c===h||l)&&k&&(g.focus(),d=!0):(h.focus(),d=!0)}d&&a.preventDefault()}}}}),"extends":"dialog"});e.registerElement("ha-toolbar",{prototype:Object.create(HTMLElement.prototype,{attachedCallback:{value:function(){this.addEventListener("mousedown",
this.action,!1);e.addEventListener("selectionchange",this.show.bind(this),!1);this.define("action",this.querySelectorAll("[name]").serialize())}},action:{value:function(a){a.preventDefault();a=a.target.name;if(void 0!==a)switch(a){case "createLink":var d;a=this.range;void 0!==a&&(d=a.commonAncestorContainer.parentElement.href);c.dialog.render(b.message.createLink,{value:d});break;case "bold":case "italic":case "underline":e.execCommand(a,!1,null)}}},show:{value:function(){var a=c.getSelection(),b=
a.anchorNode,f=c.content;if(0===a.rangeCount||null===f)return this.close();for(;null!==b&&b!==f;)b=b.parentElement;if(null===b)return this.close();this.range=a.getRangeAt(0);a=this.range.getBoundingClientRect();if(0==a.left||0==a.top)return this.close();this.style.left="{}px".format(c.scrollX+a.left+.5*a.width);this.style.top="{}px".format(c.scrollY+a.top);this.setAttribute("open","")}},close:{value:function(){this.removeAttribute("open")}}})});e.registerElement("ha-editor",{prototype:Object.create(HTMLElement.prototype,
{attachedCallback:{value:function(){b.observer.observe(this,{childList:!0,characterData:!0,subtree:!0});this.addEventListener("keydown",this.keys,!1);this.addEventListener("blur",this.save,!1)}},save:{value:function(){HB.root.dispatchEvent(new CustomEvent("change",{detail:this}))}},keys:{value:function(a){var c=!1;switch(a.keyCode){case b.KEY.S:if(a.metaKey||a.ctrlKey)this.save(),c=!0}c&&a.preventDefault()}}})});NodeList.prototype.define("serialize",function(){for(var a={},b=0;b<this.length;b++){var c=
this[b],e=c.name,g=c.value;""!==e&&(a[e]=void 0!==g?g:c)}return a});Object.prototype.define("has",function(a){for(var b in this)if(a.handle===b&&a.title===this[b])return!0;return!1})})(this);