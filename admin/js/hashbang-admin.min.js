(function(c){var l=c.document,h=c.location,g=l.documentElement,b=c.HA={version:"0.0.7",endpoint:"api/",main:function(){b.dialog=c.dialog;b.request=new HB.Request(b.endpoint);b.request.get({success:b.sync,error:b.error});b.upload.init()},update:function(){var a=l.querySelector("textarea");null!==a&&a.addEventListener("keydown",b.textarea,!1);c.toggle.checked=!1},textarea:function(a){var d=!1;switch(a.keyCode){case b.KEY.S:if(!a.metaKey&&!a.ctrlKey)break;d=new CustomEvent("change",{detail:this});HB.root.dispatchEvent(d);
d=!0;break;case b.KEY.TAB:var d=this.selectionStart,e=this.selectionEnd,c=this.value;this.value=c.slice(0,d)+"\t"+c.slice(e);this.selectionStart=this.selectionEnd=d+1;d=!0}d&&a.preventDefault()},block:{target:null,init:function(a){var d=a.querySelectorAll("dt");a=a.querySelectorAll("dd");for(var e=0;e<d.length;e++){var c=d[e];c.addEventListener("dragenter",b.block.enter,!1);c.addEventListener("dragover",b.block.drag,!1);c.addEventListener("dragleave",b.block.leave,!1);c.addEventListener("drop",b.block.drop,
!1)}for(e=0;e<a.length;e++)d=a[e],d.addEventListener("dragstart",b.block.start,!1),d.addEventListener("dragend",b.block.end,!1)},start:function(a){a.dataTransfer.effectAllowed="move";b.block.target=this;g.classList.add("move")},end:function(){b.block.target=null;g.classList.remove("move")},enter:function(a){null!==b.block.target&&(a.dataTransfer.dropEffect="move",this.classList.add("target"))},leave:function(){null!==b.block.target&&this.classList.remove("target")},drag:function(a){null!==b.block.target&&
a.preventDefault()},drop:function(a){null!==b.block.target&&(b.request.send({method:"POST",success:b.sync,error:b.error,data:{type:"block",id:b.block.target.dataset.id,key:"collectionId",value:this.dataset.id}}),b.block.leave.call(this),a.preventDefault())}},upload:{valid:/image\/(jpeg|png|svg\+xml)/,init:function(){c.addEventListener("dragenter",b.upload.enter,!1);c.addEventListener("dragend",b.upload.end,!1);c.upload.addEventListener("dragenter",b.upload.drag,!1);c.upload.addEventListener("dragover",
b.upload.drag,!1);c.upload.addEventListener("dragleave",b.upload.leave,!1);c.upload.addEventListener("drop",b.upload.drop,!1)},enter:function(a){var b=a.target;b!==c.upload?a.dataTransfer.dropEffect="none":(a.dataTransfer.dropEffect="copy",b.classList.add("target"));g.classList.add("upload")},leave:function(){c.upload.classList.remove("target")},end:function(a){b.upload.leave();g.classList.remove("upload");a.preventDefault()},drag:function(a){b.upload.enter(a);a.preventDefault();a.stopPropagation()},
drop:function(a){b.upload.parse(a.dataTransfer.files);b.upload.end(a)},parse:function(a){if(0!=a.length&&b.upload.valid.test(a[0].type)){var d=new FileReader;d.addEventListener("load",b.put,!1);d.readAsDataURL(a[0])}}},create:function(a,d){var e={type:a};switch(a){case b.DATA.COLLECTION:case b.DATA.TAG:case b.DATA.ATTRIBUTE:e.key="handle";e.value="new-{}".format(a);break;case b.DATA.BLOCK:e.key="collectionId",e.value=d}b.request.send({method:"POST",success:b.sync,error:b.error,data:e})},sync:function(a){var d=
c.overview,e=c.tags,k=c.attributes;b.metadata={attributes:a.attributes,collections:a.collections,tags:a.tags,images:a.images};d.replaceChildren(c.nav.render(a.collections));e.replaceChildren(c.datalist.render(a.tags));k.replaceChildren(c.datalist.render(a.attributes));b.block.init(d);void 0===HB.root&&(HB.noCache=!0,HB.main(),HB.root.addEventListener("update",b.update,!1),HB.root.addEventListener("change",b.save,!1),HB.root.addEventListener("submit",b.prevent,!1));null!==a.target&&(!0===a.target?
c.dispatchEvent(new Event("hashchange")):h.hash=a.target)},prevent:function(a){a.preventDefault();a.stopPropagation()},save:function(a){a=a.detail||a.target;var d=a.dataset,e=d.type,d=+d.id,c=a.name,f=a.value;if(""!==c&&a.validity.valid){switch(e){case b.DATA.TAG:case b.DATA.ATTRIBUTE:if("handle"===c&&""===f)return b["delete"](e,d,-1);break;case b.DATA.BLOCK_TAG:case b.DATA.BLOCK_ATTRIBUTE:if(!a.checked)return b["delete"](e,d,f);break;case b.DATA.IMAGE:b.upload.parse(a.files)}b.request.send({method:"POST",
success:b.sync,error:b.error,data:{type:e,id:d,key:c,value:f}})}},"delete":function(a,d,c){if(-1===c)return b.dialog.render(b.message["delete"],{type:a,id:d});a===b.DATA.IMAGE&&(a+="/"+{jpg:"jpeg",png:"png",svg:"svg+xml"}[d.split(".").pop()]);b.request.send({method:"DELETE",success:b.sync,error:b.error,data:{type:a,id:d,value:c}})},put:function(a){a=this.result;b.request.send({method:"PUT",success:b.sync,error:b.error,data:{type:a.match(b.upload.valid)[0],value:a.split(",")[1]}})},error:function(a){g.classList.add("error");
b.dialog.render(b.message[a.status]||b.message.error)},logout:function(){b.request.error=null;b.request.xhr.open("HEAD",":protocol//logout@:host:port:pathname".format(h)+b.endpoint);b.request.xhr.send();h.reload(!0)},DATA:{COLLECTION:"collection",BLOCK:"block",TAG:"tag",ATTRIBUTE:"attribute",BLOCK_TAG:"blockTag",BLOCK_ATTRIBUTE:"blockAttribute",IMAGE:"image"},KEY:{TAB:9,ESC:27,S:83},message:{"delete":{title:"Are you sure you want to delete this :type?",description:"This action cannot be undone!",
buttons:[{title:"Cancel"},{title:"OK",action:"delete"}]},error:{title:"Something went wrong!",description:"Please try again.",buttons:[{title:"Reload",action:"reload"},{title:"OK"}]},400:{title:"Something went seriously wrong!"},401:{title:"You are not authorized!"},500:{title:"Something went wrong on the server!"}}};l.registerElement("ha-dialog",{prototype:Object.create(HTMLDialogElement.prototype,{attachedCallback:{value:function(){this.addEventListener("close",this.callback,!1);c.addEventListener("keydown",
this.keys.bind(this),!1)}},render:{value:function(a,b){a=Object.create(a);var e=a.buttons;if(void 0!==e){void 0===b&&(b={});for(var k in e){var f=e[k].action;if(void 0!==f){b.action=f;break}}a.title=a.title.format(b);a.data=JSON.stringify(b).replace(/"/g,"\\'")}this.replaceChildren(c.message.render(a));this.show()}},callback:{value:function(){var a=this.returnValue.replace(/\'/g,'"');if(""!==a&&(a=JSON.parse(a),void 0!==a.action))switch(a.action){case "delete":b["delete"](a.type,a.id);break;case "reload":h.reload(!0)}}},
keys:{value:function(a){var d=!1;if(this.open){switch(a.keyCode){case b.KEY.ESC:this.close();d=!0;break;case b.KEY.TAB:var c=a.target,k=a.shiftKey,f=this.querySelectorAll("button"),g=f[0],f=f[f.length-1],h=c===l.body;c!==f&&!h||k?(c===g||h)&&k&&(f.focus(),d=!0):(g.focus(),d=!0)}d&&a.preventDefault()}}}}),"extends":"dialog"});Object.defineProperty(Object.prototype,"has",{value:function(a){for(var b in this)if(a.handle===b&&a.title===this[b])return!0;return!1}})})(this);
