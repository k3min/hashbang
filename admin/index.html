<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title data-spec="{}: {}">Hashbang Admin</title>
		<link rel="stylesheet" href="css/style.css">
		<script src="../js/hashbang.min.js"></script>
		<script src="js/hashbang-admin.min.js"></script>
	</head>
	<body>
		<nav id="overview"></nav>
		<form id="root"></form>
		<datalist id="tags"></datalist>
		<datalist id="attributes"></datalist>
		<template id="nav" is="hb-template">
			<dl>
				{% this.forEach(function (collection) { %}
				<dt><a href="{{ collection.url }}">{{ collection.title }}</a><a onclick="HA.create(HA.TYPE.BLOCK, {{ collection.id }});" class="create block" title="Add new block to {{ collection.title }}">Add new block to {{ collection.title }}</a></dt>
				{% collection.blocks.forEach(function (block) { %}
				<dd><a href="{{ block.url }}">{{ block.title }}</a></dd>
				{% }); %}
				{% }); %}
				<dt><a onclick="HA.create(HA.TYPE.COLLECTION);" class="create collection">Create new collection</a></dt>
			</dl>
		</template>
		<template id="datalist" is="hb-template">
			{% this.forEach(function (item) { %}
			<option>{{ item.title }}</option>
			{% }); %}
		</template>
		<template id="collection" is="hb-template">
			<div class="input after">
				<label for="title">Title</label>
				<input name="title" value="{{ this.title }}" maxlength="64" id="title" class="h1">
			</div>
			<div class="input after">
				<label for="handle">Handle</label>
				<input name="handle" value="{{ this.handle }}" maxlength="32" pattern="[a-z0-9-]+" placeholder="please-use-lowercase-letters-and-0123456789" id="handle" class="code" required>
			</div>
			<div class="input">
				<label for="description">Description</label>
				<input name="description" value="{{ this.description }}" maxlength="128" id="description">
			</div>
			<div class="input after">
				<label for="type">Type</label>
				<input name="type" value="{{ this.type }}" maxlength="16" pattern="[a-z0-9-]+" id="type" class="code">
			</div>
			<input type="button" value="Delete" onclick="HA.delete();" class="delete">
		</template>
		<template id="block" is="hb-template">
			{% var id = +this.id; %}
			{% this.blocks.forEach(function (block) { %}
			<div class="input after">
				<label for="title">Title</label>
				<input name="title" value="{{ block.title }}" maxlength="64" id="title" class="h1">
			</div>
			<div class="input after">
				<label for="handle">Handle</label>
				<input name="handle" value="{{ block.handle }}" maxlength="32" pattern="[a-z0-9-]+" placeholder="please-use-underscore-letters-and-0123456789" id="handle" class="code" required>
			</div>
			<div class="input">
				<label for="description">Description</label>
				<input name="description" value="{{ block.description }}" maxlength="128" id="description">
			</div>
			<div class="input">
				<label for="content">Content</label>
				<textarea name="content" id="content" rows="10">{{ block.content }}</textarea>
			</div>
			<div class="input">
				<label for="time">Time</label>
				<input name="time" type="datetime-local" value="{{ block.time.format('Y-m-d\TH:i:s') }}" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}(:[0-9]{2})?" id="time">
			</div>
			<div class="input">
				<label>Tags</label>
				<table>
					{% for (var i in block.tags) { %}
					<tr>
						<td><input value="{{ i }}" placeholder="Key"></td>
						<td><input value="{{ block.tags[i] }}" list="tags" placeholder="Value"></td>
					</tr>
					{% } %}
				</table>
			</div>
			<div class="input">
				<label>Attributes</label>
				<table>
					{% for (var i in block.attributes) { %}
					<tr>
						<td><input value="{{ i }}" placeholder="Key"></td>
						<td><input value="{{ block.attributes[i] }}" list="attributes" placeholder="Value"></td>
					</tr>
					{% } %}
				</table>
			</div>
			<div class="input">
				<label>Parent</label>
				<select name="collectionId">
					{% HA.metadata.collections.forEach(function (parent) { %}
					{% if (parent.id === id) { %}
					<option value="{{ parent.id }}" selected>{{ parent.title }}</option>
					{% } else { %}
					<option value="{{ parent.id }}">{{ parent.title }}</option>
					{% } %}
					{% }); %}
				</select>
			</div>
			<div class="input after">
				<label for="type">Type</label>
				<input name="type" value="{{ block.type }}" maxlength="16" pattern="[a-z0-9-]+" id="type" class="code">
			</div>
			<input type="button" value="Delete" onclick="HA.delete();" class="delete">
			{% }); %}
		</template>
		<script>
			HB.endpoint = "../api/:handle";
			HA.main();
		</script>
	</body>
</html>