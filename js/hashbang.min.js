(function(e){var g=e.document,r=e.location,h=g.documentElement,k=Object.defineProperty,l=Object.create,u=function(a){var c=navigator.appVersion;return/Trident/.test(c)&&c.match(/Trident\/([0-9])/)[1]<=a},d=e.HB={version:"2.0.7",endpoint:"api/:handle",collections:{},main:function(a,c){d.request=new y(d.endpoint);d.home=a||g.links[0].hash;d.root=c||e.root;d.title={text:g.title,spec:g.getElementsByTagName("title")[0].dataset.spec};d.router.fallback=d.fallback;d.router.add("/:collection(/:block)?",d.route);
d.router.match()},route:function(a,c){var b=d.collections[a];void 0===b||void 0===b.blocks||d.noCache?(b=d.collections[a]=new z,b.addEventListener("update",d.update),d.request.get({handle:a,success:b.load.bind(b),error:d.fallback})):d.request.xhr.abort();b.block=c;t.forEach(function(a){a.classList.remove("active")});t=[];for(var b=0,f=g.links;b<f.length;b++)f[b].hash.substr(3)===a&&(f[b].classList.add("active"),t.push(f[b]))},update:function(a){a=a.detail;var c=d.title,b=d.root,f=h.classList;for(g.title=
c.spec.format(c.text,a.title);b.firstChild;)b.removeChild(b.firstChild);b.appendChild(this);f.remove(v);f.add(v=a.handle);f.remove(w);f.add(w=a.type);b.dispatchEvent(new CustomEvent("update",{detail:this}))},fallback:function(){r.hash=d.home}},t=[],v,w,m=e.klass=function(a){var c=a.constructor,b=this&&this.prototype||!1;b&&(c.prototype=l(b,{parent:{value:b}}));for(var f in a){var b=a[f],d=f.split("$")[0],g=/\$static/.test(f)?c:c.prototype,e={enumerable:!/\$hidden|^constructor/.test(f)};null===b||
"function"!==typeof b.get&&"function"!==typeof b.set?(e.value=b,e.writable="function"!==typeof b):(e.get=b.get,e.set=b.set);k(g,d,e)}return c};k(Object.prototype,"extend",{value:m});if(void 0===g.registerElement){var p={},x=function(a,c){u(6)?Object.getOwnPropertyNames(c).forEach(function(b){k(a,b,Object.getOwnPropertyDescriptor(c,b))}):a.__proto__=c};g.registerElement=function(a,c){p[a]=c;var b=function(){var b=g.createElement(a);x(b,c.prototype);return b};b.prototype=c.prototype;k(b.prototype,"constructor",
{value:b});return b};g.addEventListener("DOMContentLoaded",function(){for(var a in p){var c;c=p[a]["extends"];c=void 0!==c?g.querySelectorAll("{}[is={}]".format(c,a)):g.getElementsByTagName(a);for(var b=0;b<c.length;b++)x(c[b],p[a].prototype),"function"===typeof c[b].attachedCallback&&c[b].attachedCallback.call(c[b])}})}void 0===e.HTMLTemplateElement&&(e.HTMLTemplateElement=HTMLElement.extend({constructor:function(){console.error("Illegal constructor")}}));d.Template=g.registerElement("hb-template",
{prototype:l(HTMLTemplateElement.prototype,{attachedCallback:{value:function(){var a=this.innerHTML,a=a.replace(/\s{2,}/g,""),a=a.replace(/\{\{(.*?)\}\}/g,"',$1,'"),a=a.split("{%").join("');"),a=a.split("%}").join("a.push('"),a="var a=[];a.push('"+a+"');return a.join('');";this.range=g.createRange();this.source=new Function(a)}},render:{value:function(a){this.range.selectNode(g.body);return this.range.createContextualFragment(this.source.call(a))}}}),"extends":"template"});var z=d.Collection=g.registerElement("hb-collection",
{prototype:l(HTMLElement.prototype,{load:{value:function(a){this.id=a.id;this.handle=a.handle;this.title=a.title;this.description=a.description;this.type=a.type;this.url=a.url;this.template=e[a.type]||e.collection||e["default"];this.blocks=a.blocks.map(function(a){return new A(a)});void 0!==this.template.dataset.sort?this.sort(this.template.dataset.sort):this.update()}},id:{get:function(){return this._id},set:function(a){this._id=a}},title:{get:function(){return this._title},set:function(a){this._title=
a}},block:{get:function(){return this._block},set:function(a){this._block=a;void 0!==this.blocks&&this.update()}},sort:{value:function(a){var c="-"===a[0]?(a=a.substr(1),-1):1;this.blocks.sort(function(b,f){b=b.reduce(a);f=f.reduce(a);return(b<f?-1:b>f?1:0)*c});this.update()}},search:{value:function(a,c){var b=l(this);b.blocks=b.blocks.filter(function(b){return b.reduce(a)===c});return b}},update:{value:function(){var a=void 0===this._block?this:this.search("handle",this._block),c={id:this.id,handle:this.handle,
title:this.title,type:this.type,template:this.template};if(void 0!==this._block){c=a.blocks[0];if(void 0===c)return r.hash="#!/"+this.handle;c={id:c.id,handle:c.handle,title:c.title,type:c.type,template:c.template}}if(void 0===c.template)return a="Template #{} is not defined".format(c.type),console.error(a);for(;this.firstChild;)this.removeChild(this.firstChild);this.appendChild(c.template.render(a));this.dispatchEvent(new CustomEvent("update",{detail:c}))}}})}),A=d.Block=m({constructor:function(a){for(var c in a)this[c]=
a[c];this.time=new Date(a.time);this.template=e[a.type]||e.block||e["default"]},reduce:function(a){a=a.split(".");var c=this[a[0]];if(void 0!==a[1])for(var b=1;b<a.length;b++)c=c[a[b]];return c}}),B=d.Router=m({constructor:function(a){this.fallback=a||null;e.addEventListener("hashchange",this.match.bind(this))},add$hidden:function(a,c){var b=a,f=/\((\/:[a-z]+)\)\?/g;f.test(a)&&(a=a.replace(f,"(?:$1)?"));f=new RegExp(a.replace(/:[a-z]+/g,"([a-z0-9-]+)"),"i");this[b]=c;this[b].regExp=f},match$hidden:function(){var a=
!0,c;for(c in this)if("fallback"!==c){var b=r.hash.match(this[c].regExp);null!==b&&(b.shift(),this[c].apply(this,b),a=!1)}a&&"function"===typeof this.fallback&&this.fallback()}});d.router=new B;var y=d.Request=m({constructor:function(a){this.endpoint=a;this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",this.load.bind(this))},send:function(a){var c=a.method,b=a.accept||"application/json",f=a.response||"json",d=a.data||null;h.classList.add("loading");this.success=a.success;this.error=a.error;
this.xhr.open(c,this.endpoint.format(a));this.xhr.responseType=f;this.xhr.setRequestHeader("Accept",b);"GET"!==c&&null!==d&&(a=a.type||"application/json",this.xhr.setRequestHeader("Content-Type",a),"application/json"===a&&(d=JSON.stringify(d)));this.xhr.send(d)},get:function(a){a.method="GET";this.send(a)},load:function(){try{var a=this.xhr.response;200===this.xhr.status?"function"===typeof this.success&&this.success(a):"function"===typeof this.error&&this.error(a)}catch(c){c.status=-1,"function"===
typeof this.error?this.error(c):console.error(c)}finally{h.classList.remove("loading")}}});String.prototype.format=function(a){var c=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(/:([a-z]+)|\{([0-9])?\}/g,function(b,f,d){return a[f||d||c++]})};Date.prototype.format=function(a){var c=Date.ordinals,b=Date.days,d=Date.months,e=this.getDate(),g=this.getDay(),n=this.getMonth(),k=this.getFullYear(),q=this.getHours(),h=q%12||12,l=this.getMinutes(),m=this.getSeconds(),p={d:10>e?
"0"+e:e,D:b[g].substr(0,3),j:e,l:b[g],N:g||7,S:3<e&&20>=e?c[0]:c[e%10]||c[0],w:g,F:d[n],m:10>n?"0"+(n+1):n+1,M:d[n].substr(0,3),n:n+1,t:(new Date(k,n+1,0)).getDate(),Y:k,y:(""+k).substr(2,2),a:12>q?"am":"pm",A:12>q?"AM":"PM",g:h,G:q,h:10>h?"0"+h:h,H:10>q?"0"+q:q,i:10>l?"0"+l:l,s:10>m?"0"+m:m};return a.replace(/\\?([a-z])/gi,function(a,b){return void 0!==p[a]?p[a]:b})};Date.ordinals=["th","st","nd","rd"];Date.days="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");Date.months="January February March April May June July August September October November December".split(" ");
void 0===h.dataset&&k(HTMLElement.prototype,"dataset",{get:function(){for(var a={},c=this.attributes,b=0;b<c.length;b++){var d=c[b].name.split("-");void 0!==d[1]&&"data"===d[0]&&(a[d[1]]=c[b].value)}return a}});u(7)&&(e.CustomEvent=Event.extend({constructor:function(a,c){var b=g.createEvent("CustomEvent");b.initCustomEvent(a,!1,!1,c.detail);return b}}))})(this);