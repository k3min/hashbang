(function(f){var e=f.document,n=f.location,g=Object.defineProperty,k=Object.create,q=function(a){var b=navigator.appVersion;return/Trident/.test(b)&&b.match(/Trident\/([0-9])/)[1]<=a},d=f.HB={version:"2.0.1",endpoint:"api/:handle",collections:{},main:function(a,b){this.request=new x(this.endpoint);this.home=a||e.links[0].hash;this.root=b||f.root;this.title={text:e.title,spec:e.getElementsByTagName("title")[0].dataset.spec};this.router.fallback=this.fallback;this.router.add("/:collection",function(a){void 0===
d.collections[a]?(d.collections[a]=new y,d.collections[a].addEventListener("update",d.update,!1),d.request.get({handle:a,success:function(b){d.collections[a].load(b)},error:function(){delete d.collections[a];d.fallback()}})):d.collections[a].block=void 0});this.router.add("/:collection/:block",function(a,b){d.collections[a].block=b});this.router.match()},update:function(a){a=a.detail;for(e.title=d.title.spec.format(d.title.text,a.title);d.root.firstChild;)d.root.removeChild(d.root.firstChild);d.root.appendChild(d.collections[a.handle]);
e.body.classList.remove(r);e.body.classList.add(r=a.handle);e.body.classList.remove(s);e.body.classList.add(s=a.type)},fallback:function(){n.hash=d.home}},r,s,m=f.klass=function(a){var b=a.constructor;if(void 0!==this){var c=this.prototype;b.prototype=k(c,{parent:{get:function(){return c}}})}for(var d in a){var e=a[d],f=d.split("$")[0],l=/\$static/.test(d)?b:b.prototype,t=!/\$hidden|constructor/.test(d);void 0!==e.get||void 0!==e.set?g(l,f,{enumerable:t,get:e.get,set:e.set}):g(l,f,{enumerable:t,value:e})}return b};
g(Object.prototype,"extend",{value:m});if(void 0===e.registerElement){var h={},u=function(a,b){q(6)?Array.apply(null,Object.getOwnPropertyNames(b)).forEach(function(c){g(a,c,Object.getOwnPropertyDescriptor(b,c))}):a.__proto__=b};e.registerElement=function(a,b){h[a]=b;var c=function(){var c=e.createElement(a);u(c,b.prototype);return c};c.prototype=b.prototype;g(c.prototype,"constructor",{value:c});return c};e.addEventListener("DOMContentLoaded",function(){for(var a in h){var b=h[a]["extends"]?"{}[is={}]".format(h[a]["extends"],
a):a;Array.apply(null,e.querySelectorAll(b)).forEach(function(b){u(b,h[a].prototype);void 0!==b.attachedCallback&&b.attachedCallback.call(b)})}},!1)}void 0===f.HTMLTemplateElement&&(f.HTMLTemplateElement=HTMLElement.extend({constructor:function(){console.error("Illegal constructor")}}));d.Template=e.registerElement("hb-template",{prototype:k(HTMLTemplateElement.prototype,{attachedCallback:{value:function(){var a=this.innerHTML,a=a.replace(/\s{2,}/g,""),a=a.replace(/\{\{=(.*?)\}\}/g,"';html+=$1;html+='"),
a=a.split("{{").join("';"),a=a.split("}}").join("html+='");this.source=new Function("collection","var html='"+a+"';return html;")}},render:{value:function(a){return this.source(a)}}}),"extends":"template"});var y=d.Collection=e.registerElement("hb-collection",{prototype:k(HTMLElement.prototype,{load:{value:function(a){this.id=a.id;this.handle=a.handle;this.title=a.title;this.type=a.type;this.template=f[a.type];this.blocks=a.blocks.map(function(a){return new z(a)});void 0!==this.template.dataset.sort?
this.sort(this.template.dataset.sort):this.update()}},block:{get:function(){return this._block},set:function(a){this._block=a;void 0!==this.blocks&&this.update()}},sort:{value:function(a){var b="-"===a[0]?(a=a.substr(1),-1):1;this.blocks.sort(function(c,d){c=c.reduce(a);d=d.reduce(a);return(c<d?-1:c>d?1:0)*b});this.update()}},search:{value:function(a,b){var c=k(this);c.blocks=c.blocks.filter(function(c){return c.reduce(a)===b});return c}},update:{value:function(){var a=void 0===this._block?this:this.search("handle",
this._block),b={handle:this.handle,title:this.title,type:this.type,template:this.template};if(void 0!==this._block){if(0===a.blocks.length)return n.hash="#!/"+this.handle;b.title=a.blocks[0].title;b.type=a.blocks[0].type;b.template=a.blocks[0].template}if(void 0===b.template)return console.error("Template #{} is not defined".format(b.type));for(;this.firstChild;)this.removeChild(this.firstChild);this.insertAdjacentHTML("beforeend",b.template.render(a));this.dispatchEvent(new CustomEvent("update",
{detail:b}))}}})}),z=d.Block=m({constructor:function(a){for(var b in a)this[b]=a[b];this.time=new Date(this.time);this.template=f[this.type]},reduce:function(a){a=a.split(".");var b=this[a[0]];if(void 0!==a[1])for(var c=1;c<a.length;c++)b=b[a[c]];return b}}),A=d.Router=m({constructor:function(){f.addEventListener("hashchange",this.match.bind(this),!1)},add$hidden:function(a,b){this[a]=b;this[a].match=new RegExp(a.replace(/:[a-z]+/g,"([a-z0-9-]+)"))},match$hidden:function(){var a=!0,b;for(b in this)if("fallback"!==
b){var c=n.hash.match(this[b].match);null!==c&&(c.shift(),this[b].apply(this,c),a=!1)}a&&void 0!==this.fallback&&this.fallback()}});d.router=new A;var x=d.Request=m({constructor:function(a){this.endpoint=a;this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",this.load.bind(this),!1)},get:function(a){e.body.classList.add("loading");this.success=a.success;this.error=a.error;this.xhr.open("GET",this.endpoint.format(a),!0);this.xhr.setRequestHeader("Accept","application/json");this.xhr.send(null)},
load:function(){var a=JSON.parse(this.xhr.responseText);200===this.xhr.status&&"function"===typeof this.success?this.success(a):"function"===typeof this.error&&this.error(a);e.body.classList.remove("loading")}});String.prototype.format=function(a){var b=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(/:([a-z]+)|\{([0-9])?\}/g,function(c,d,e){return a[d||e||b++]})};Date.prototype.format=function(a){var b=this.getDate(),c=this.getDay(),d=this.getMonth(),e=this.getFullYear(),
f=this.getHours(),l=f%12||12,g=this.getMinutes(),h=this.getSeconds(),k={d:10>b?"0"+b:b,D:v[c].substr(0,3),j:b,l:v[c],N:c||7,S:3<b&&20>=b?p[0]:p[b%10]||p[0],w:c,F:w[d],m:10>d?"0"+(d+1):d+1,M:w[d].substr(0,3),n:d+1,t:(new Date(e,d+1,0)).getDate(),Y:e,y:(""+e).substr(2,2),a:12>f?"am":"pm",A:12>f?"AM":"PM",g:l,G:f,h:10>l?"0"+l:l,H:10>f?"0"+f:f,i:10>g?"0"+g:g,s:10>h?"0"+h:h};return a.replace(/\\?([a-z])/gi,function(a,b){return void 0!==k[a]?k[a]:b})};var p=Date.ordinals=["th","st","nd","rd"],v=Date.days=
"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),w=Date.months="January February March April May June July August September October November December".split(" ");void 0===e.documentElement.dataset&&g(HTMLElement.prototype,"dataset",{get:function(){var a={};Array.apply(null,this.attributes).forEach(function(b){var c=b.name.split("-");void 0!==c[1]&&"data"===c[0]&&(a[c[1]]=b.value)});return a}});q(7)&&(f.CustomEvent=Event.extend({constructor:function(a,b){var c=e.createEvent("CustomEvent");
c.initCustomEvent(a,!1,!1,b.detail);return c}}))})(this);