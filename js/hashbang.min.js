(function(h){var d=h.document,k=h.location,b=h.HB={version:"1.2.2",endpoint:"api/:handle",collections:{},cache:!0,main:function(a,b){this.home=a||d.querySelector("a").hash;this.target=b||d.querySelector("[data-role=target]");this.title={text:d.title,spec:d.getElementsByTagName("title")[0].dataset.spec};this.router=new m;this.router.match()}},c=b.Template=function(a){this.type=a;if(void 0===c.templates[this.type]){try{var b="script[data-type={}]".format(this.type),g=d.querySelector(b).text}catch(e){throw Error("Template '{}' does not exist!".format(this.type));
}c.templates[this.type]=g.replace(q,"")}this.source=c.templates[this.type]};c.prototype.render=function(a){c.placeholder.innerHTML=this.source.replace(c.regex,c.replacer.bind(a));return Array.apply(null,c.placeholder.childNodes)};c.regex=/\{([\w\.]+)\}/g;c.templates={};c.placeholder=d.createElement("div");c.replacer=function(a,b){return b.split(".").reduce(function(a,b){return a[b]},this)};var q=/\s{2,}/g,m=b.Router=function(){this.route=[];h.addEventListener("hashchange",this.match.bind(this),!1)};
m.prototype.match=function(){var a=k.hash.split("#!/")[1];if(void 0===a)return k.hash=b.home;this.route=a.split("/");void 0!==b.collections[this.route[0]]&&b.cache?b.collections[this.route[0]].show(this.route[1]):b.request.get({handle:this.route[0]})};var l=b.Request=function(){this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",l.callback,!1)};l.prototype.get=function(a){d.body.classList.add("loading");this.xhr.open("GET",b.endpoint.format(a),!0);this.xhr.setRequestHeader("Accept","application/json");
this.xhr.send(null)};l.callback=function(){if(200===this.status){var a=JSON.parse(this.response);b.collections[a.handle]=new f(a);b.collections[a.handle].show(b.router.route[1])}else k.hash=b.home;d.body.classList.remove("loading")};b.request=new l;var f=b.Collection=function(a){this.blocks={};this.id=a.id;this.handle=a.handle;this.title=a.title;this.showTitle=a.showTitle;this.template=new c(a.type);for(var b in a.blocks)this.blocks[b]=new n(a.blocks[b])};f.prototype.show=function(a){if(void 0!==
a&&void 0===this.blocks[a])return k.hash="#!/{}".format(this.handle);for(var c=this.title,g=this.template.type;b.target.firstChild;)b.target.removeChild(b.target.firstChild);if(void 0!==a){var e=this.blocks[a],c=e.title,g=e.template.type;e.show()}else for(e in this.showTitle&&(f.title.textContent=this.title,b.target.appendChild(f.title)),this.blocks)this.blocks.hasOwnProperty(e)&&this.blocks[e].show(this.template);d.title=b.title.spec.format(b.title.text,c);d.body.classList.remove(p);d.body.classList.add(g);
p=g};f.title=d.createElement("h1");var p,n=b.Block=function(a){for(var b in a)this[b]=a[b];this.template=new c(a.type)};n.prototype.show=function(a){(a||this.template).render(this).forEach(function(a){b.target.appendChild(a)})};String.prototype.format=function(a){var b=0;a="string"===typeof a?Array.apply(null,arguments):a;return this.replace(r,function(c,d,f){return a[d||f||b++]})};var r=/:(\w+)|\{([0-9])?\}/g})(this);