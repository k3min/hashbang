(function(b){b.HB={home:"",api:"api/:handle",request:null,router:null,target:null,collections:{},title:{},version:"1.1.3",main:function(){this.home=document.getElementsByTagName("a")[0].hash;this.target=document.querySelector("[data-role=target]");this.title={text:document.title,spec:document.getElementsByTagName("title")[0].dataset.spec};this.request=new HB.Request;this.router=new HB.Router}};b.HB.Template=function(a){this.type=a;void 0===HB.Template.templates[this.type]&&(a="script[data-type={}]".format(this.type),
a=document.querySelector(a).text,HB.Template.templates[this.type]=a.replace(/\s{2,}/g,""));this.source=HB.Template.templates[this.type]};b.HB.Template.prototype.render=function(a){HB.Template.placeholder.innerHTML=this.source.replace(HB.Template.regex,HB.Template.replacer.bind(a));return HB.Template.placeholder.childNodes[0]};b.HB.Template.regex=/\{([\w\.]+)\}/g;b.HB.Template.templates={};b.HB.Template.placeholder=document.createElement("div");b.HB.Template.replacer=function(a,b){return b.split(".").reduce(function(a,
b){return a[b]},this)};b.HB.Router=function(){this.route=[];this.match();b.addEventListener("hashchange",this.match.bind(this),!1)};b.HB.Router.prototype.match=function(){this.route=location.hash.split("#!/")[1];if(void 0===this.route)return location.hash=HB.home;this.route=this.route.split("/");void 0===HB.collections[this.route[0]]?HB.request.get({handle:this.route[0]}):HB.collections[this.route[0]].show(this.route[1])};b.HB.Request=function(){this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",
HB.Request.callback,!1)};b.HB.Request.prototype.get=function(a){document.body.classList.add("loading");this.xhr.open("GET",HB.api.format(a),!0);this.xhr.send(null)};b.HB.Request.callback=function(){if(200===this.status){var a=JSON.parse(this.response);HB.collections[a.handle]=new HB.Collection(a);HB.collections[a.handle].show(HB.router.route[1])}else location.hash=HB.home;document.body.classList.remove("loading")};b.HB.Collection=function(a){this.blocks={};this.id=a.id;this.handle=a.handle;this.title=
a.title;this.type=a.type;this.showTitle=a.showTitle;this.template=new HB.Template(this.type);for(var b in a.blocks)this.blocks[b]=new HB.Block(a.blocks[b])};b.HB.Collection.prototype.show=function(a){for(var b=this.title,d=this.type;HB.target.firstChild;)HB.target.removeChild(HB.target.firstChild);if(void 0===a||0===a.length){this.showTitle&&(HB.Collection.title.textContent=this.title,HB.target.appendChild(HB.Collection.title));for(var c in this.blocks)this.blocks[c].show(this.template)}else void 0!==
this.blocks[a]?(c=this.blocks[a],b=c.title,d=c.type,c.show()):location.hash="#!/{}".format(this.handle);document.title=HB.title.spec.format(HB.title.text,b);document.body.dataset.type=d};b.HB.Collection.title=document.createElement("h1");b.HB.Block=function(a){for(var b in a)this[b]=a[b];this.template=new HB.Template(this.type)};b.HB.Block.prototype.show=function(a){HB.target.appendChild((a||this.template).render(this))};String.prototype.format=function(a){var b=0;a="string"===typeof a?Array.apply(null,
arguments):a;return this.replace(/:(\w+)|\{([0-9])?\}/g,function(d,c,e){return a[c||e||b++]})};b.addEventListener("load",HB.main.bind(HB),!1)})(this);