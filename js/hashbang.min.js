(function(f){var e=f.document,m=f.location,g=Object.defineProperty,k=Object.create,d=f.HB={version:"2.0.0",endpoint:"api/:handle",collections:{},main:function(){this.request=new t(this.endpoint);this.home=e.links[0].hash;this.root=f.root;this.title={text:e.title,spec:e.getElementsByTagName("title")[0].dataset.spec};this.router.fallback=this.fallback;this.router.add("/:collection",function(a){void 0===d.collections[a]?(d.collections[a]=new u,d.request.get({handle:a,success:function(c){d.collections[a].load(c)},
error:function(){delete d.collections[a];d.fallback()}})):d.collections[a].block=void 0;for(;d.root.firstChild;)d.root.removeChild(d.root.firstChild);d.root.appendChild(d.collections[a])});this.router.add("/:collection/:block",function(a,c){d.collections[a].block=c});this.router.match()},fallback:function(){m.hash=d.home}},l=f.klass=function(a){var c=a.constructor;void 0!==this.prototype&&(c.prototype=k(this.prototype,{parent:{value:this.prototype}}));for(var b in a){var p=b.split("$")[0],d=/\$static/.test(b)?
c:c.prototype,e=!/\$hidden|constructor/.test(b);void 0!==a[b].get||void 0!==a[b].set?g(d,p,{enumerable:e,get:a[b].get,set:a[b].set}):g(d,p,{enumerable:e,value:a[b]})}return c};g(Object.prototype,"extend",{value:l});if(void 0===e.registerElement){var h={},q=function(a,c){/MSIE 10/.test(navigator.appVersion)?Array.apply(null,Object.getOwnPropertyNames(c)).forEach(function(b){"constructor"!==b&&g(a,b,{value:c[b]})}):a.__proto__=c};e.registerElement=function(a,c){h[a]=c;var b=function(){var b=e.createElement(a);
q(b,c.prototype);return b};b.prototype=c.prototype;g(b.prototype,"constructor",{value:b});return b};e.addEventListener("DOMContentLoaded",function(){for(var a in h){var c=h[a]["extends"]?"{}[is={}]".format(h[a]["extends"],a):a;Array.apply(null,e.querySelectorAll(c)).forEach(function(b){q(b,h[a].prototype);void 0!==b.attachedCallback&&b.attachedCallback.call(b)})}},!1)}void 0===f.HTMLTemplateElement&&(f.HTMLTemplateElement=HTMLElement.extend({constructor:function(){console.error("Illegal constructor")}}));
d.Template=e.registerElement("hb-template",{prototype:k(f.HTMLTemplateElement.prototype,{attachedCallback:{value:function(){var a=this.innerHTML,a=a.replace(/\s{2,}/g,""),a=a.replace(/\{\{(.*?)\}\}/g,"',$1,'"),a=a.split("{%").join("');"),a=a.split("%}").join("a.push('"),a="var a=[];a.push('{}');return a.join('');".format(a);this.source=new Function(a)}},render:{value:function(a){return this.source.call(a)}}}),"extends":"template"});var u=d.Collection=e.registerElement("hb-collection",{prototype:k(HTMLElement.prototype,
{load:{value:function(a){this.id=a.id;this.handle=a.handle;this.title=a.title;this.type=a.type;this.template=f[a.type];this.blocks=a.blocks.map(function(a){return new v(a)});void 0!==this.template.dataset.sort?this.sort(this.template.dataset.sort):this.update()}},block:{get:function(){return this.currentBlock},set:function(a){this._block=a;void 0!==this.blocks&&this.update()}},sort:{value:function(a){var c="-"===a[0]?(a=a.substr(1),-1):1;this.blocks.sort(function(b,d){b=b.reduce(a);d=d.reduce(a);
return(b<d?-1:b>d?1:0)*c});this.update()}},search:{value:function(a,c){var b=k(this);b.blocks=b.blocks.filter(function(b){return b.reduce(a)===c});return b}},update:{value:function(){var a=d.collection=void 0===this._block?this:this.search("handle",this._block),c=this.type,b=this.template;if(void 0!==this._block){if(0===a.blocks.length)return m.hash="#!/"+this.handle;c=a.blocks[0].type;b=a.blocks[0].template}if(void 0===b)return console.error("Template '{}' is not defined".format(c));for(;this.firstChild;)this.removeChild(this.firstChild);
this.insertAdjacentHTML("beforeend",b.render(a))}}})}),v=d.Block=l({constructor:function(a){for(var c in a)this[c]=a[c];this.time=new Date(this.time);this.template=f[this.type]},reduce:function(a){a=a.split(".");var c=this[a[0]];if(void 0!==a[1])for(var b=1;b<a.length;b++)c=c[a[b]];return c}}),w=d.Router=l({constructor:function(){f.addEventListener("hashchange",this.match.bind(this),!1)},add$hidden:function(a,c){this[a]=c;this[a].match=new RegExp(a.replace(/:\w+/g,"(\\w+)"))},match$hidden:function(){var a=
!0,c;for(c in this)if("fallback"!==c){var b=m.hash.match(this[c].match);null!==b&&(b.shift(),this[c].apply(this,b),a=!1)}a&&void 0!==this.fallback&&this.fallback()}});d.router=new w;var t=d.Request=l({constructor:function(a){this.endpoint=a;this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",this.load.bind(this),!1)},get:function(a){this.success=a.success;this.error=a.error;this.xhr.open("GET",this.endpoint.format(a),!0);this.xhr.setRequestHeader("Accept","application/json");this.xhr.send(null);
e.body.classList.add("loading")},load:function(){var a=JSON.parse(this.xhr.response);200===this.xhr.status?this.success(a):void 0!==this.error&&this.error(a);e.body.classList.remove("loading")}});String.prototype.format=function(a){var c=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(/:(\w+)|\{([0-9])?\}/g,function(b,d,e){return a[d||e||c++]})};Date.prototype.format=function(a){var c=this.getDate(),b=this.getDay(),d=this.getMonth(),e=this.getFullYear(),f=this.getHours(),g=
f%12||12,h=this.getMinutes(),k=this.getSeconds(),l={d:10>c?"0"+c:c,D:r[b].substr(0,3),j:c,l:r[b],N:b||7,S:3<c&&20>=c?n[0]:n[c%10]||n[0],w:b,F:s[d],m:10>d?"0"+(d+1):d+1,M:s[d].substr(0,3),n:d+1,t:(new Date(e,d+1,0)).getDate(),Y:e,y:(""+e).substr(2,2),a:12>f?"am":"pm",A:12>f?"AM":"PM",g:g,G:f,h:10>g?"0"+g:g,H:10>f?"0"+f:f,i:10>h?"0"+h:h,s:10>k?"0"+k:k};return a.replace(/\\?([a-z])/gi,function(a,b){return void 0!==l[a]?l[a]:b})};var n=Date.ordinals=["th","st","nd","rd"],r=Date.days="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),
s=Date.months="January February March April May June July August September October November December".split(" ");void 0===e.documentElement.dataset&&g(Element.prototype,"dataset",{get:function(){var a={};Array.apply(null,this.attributes).forEach(function(c){var b=c.name.split("-");void 0!==b[1]&&"data"===b[0]&&(a[b[1]]=c.value)});return a}})})(this);