(function(h){var e=h.document,k=h.location,d=h.HB={version:"1.3.6",endpoint:"api/:handle",collections:{},cache:!0,main:function(a,b){this.home=a||e.getElementsByTagName("a")[0].hash;this.root=b||e.querySelector("[data-role=root]");this.title={text:e.title,spec:e.getElementsByTagName("title")[0].dataset.spec};this.router=new p;this.router.match()}},f=d.Template=function(a){var b="template[data-type={}]".format(a),b=e.querySelector(b);if(null===b)throw new q(a);if(void 0===f.sources[a]){var c=b.innerHTML,
c=c.replace(t,""),c=c.replace(u,"',$1,'"),c=c.split("{%").join("');"),c=c.split("%}").join("a.push('"),c=v.format(c);f.sources[a]=new Function(c)}this.range=e.createRange();this.source=f.sources[a];this.type=a;this.element=b};f.prototype.render=function(a,b){this.range.selectNode(a);return this.range.createContextualFragment(this.source.call(b))};f.sources={};var t=/\s{2,}/g,u=/\{\{(.*?)\}\}/g,v="var a=[];a.push('{}');return a.join('');",q=function(a){this.name="TemplateError";this.message="Type {} is not defined".format(a)};
q.prototype=Object.create(Error.prototype);var p=d.Router=function(){this.route=[];h.addEventListener("hashchange",this.match.bind(this),!1)};p.prototype.match=function(){var a=k.hash.split("#!/")[1];void 0!==a?(this.route=a.split("/"),void 0!==d.collections[this.route[0]]&&d.cache?d.collections[this.route[0]].show(this.route[1]):d.request.get({handle:this.route[0]})):k.hash=d.home};var l=d.Request=function(){this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",l.callback,!1)};l.prototype.get=
function(a){e.body.classList.add("loading");this.xhr.open("GET",d.endpoint.format(a),!0);this.xhr.setRequestHeader("Accept","application/json");this.xhr.send(null)};l.callback=function(){if(200===this.status){var a=JSON.parse(this.response);d.collections[a.handle]=new g(a);d.collections[a.handle].show(d.router.route[1])}else k.hash=d.home;e.body.classList.remove("loading")};d.request=new l;var g=d.Collection=function(a){this.id=a.id;this.handle=a.handle;this.title=a.title;this.type=a.type;this.template=
new f(a.type);this.blocks=a.blocks.map(function(a){return new r(a)});this.sort(this.template.element.dataset.sort||"id")};g.prototype.clone=function(){return Object.create(this)};g.prototype.show=function(a){var b=d.collection=a?this.search("handle",a):this,c=this.title,n=this.template;if(a){if(0===b.blocks.length)return k.hash="#!/{}".format(this.handle);c=b.blocks[0].title;n=b.blocks[0].template}for(;d.root.firstChild;)d.root.removeChild(d.root.firstChild);d.root.appendChild(n.render(d.root,b));
e.body.classList.remove(s);e.body.classList.add(s=n.type);e.title=d.title.spec.format(d.title.text,c)};g.prototype.search=function(a,b){var c=this.clone();c.blocks=c.blocks.filter(function(c){return c.reduce(a)===b});return c};g.prototype.sort=function(a){var b=this.clone(),c=1;"-"===a[0]&&(a=a.substring(1),c=-1);b.blocks.sort(function(b,d){b=b.reduce(a);d=d.reduce(a);return(b<d?-1:b>d?1:0)*c});return b};var s,r=d.Block=function(a){for(var b in a)this[b]=a[b];this.time=new Date(a.time);this.template=
new f(a.type)};r.prototype.reduce=function(a){a=a.split(".");var b=this[a[0]];if(void 0!==a[1])for(var c=1;c<a.length;c++)b=b[a[c]];return b};String.prototype.format=function(a){var b=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(w,function(c,d,e){return a[d||e||b++]})};var w=/:(\w+)|\{([0-9])?\}/g;Date.prototype.format=function(a){var b=Date.ordinals,c=this.getDate(),d=this.getDay(),e=this.getMonth(),f=this.getFullYear(),m=this.getHours(),g=m%12||12,h=this.getMinutes(),
k=this.getSeconds(),l={d:10>c?"0"+c:c,D:Date.days[d].substr(0,3),j:c,l:Date.days[d],N:d||7,S:3<c&&20>=c?b[0]:b[c%10]||b[0],w:d,F:Date.months[e],m:10>e?"0"+(e+1):e+1,M:Date.months[e].substr(0,3),n:e+1,t:(new Date(f,e+1,0)).getDate(),Y:f,y:(""+f).substr(2,2),a:12>m?"am":"pm",A:12>m?"AM":"PM",g:g,G:m,h:10>g?"0"+g:g,H:10>m?"0"+m:m,i:10>h?"0"+h:h,s:10>k?"0"+k:k};return a.replace(x,function(a,b){return void 0!==l[a]?l[a]:b})};Date.ordinals=["th","st","nd","rd"];Date.days="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");
Date.months="January February March April May June July August September October November December".split(" ");var x=/\\?([a-z])/gi;void 0===e.documentElement.dataset&&Object.defineProperty(Element.prototype,"dataset",{get:function(){var a={};Array.apply(null,this.attributes).forEach(function(b){var c=b.name.split("-");void 0!==c[1]&&"data"===c[0]&&(a[c[1]]=b.value)});return a}})})(this);