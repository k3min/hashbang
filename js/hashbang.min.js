(function(k){var e=k.document,l=k.location,d=k.HB={version:"1.3.4",endpoint:"api/:handle",collections:{},cache:!0,main:function(a,c){this.home=a||e.getElementsByTagName("a")[0].hash;this.root=c||e.querySelector("[data-role=root]");this.title={text:e.title,spec:e.getElementsByTagName("title")[0].dataset.spec};this.router=new p;this.router.match()}},f=d.Template=function(a){var c="template[data-type={}]".format(a),c=e.querySelector(c);if(void 0===f.functions[a]){var b=c.innerHTML,b=b.replace(s,""),
b=b.replace(t,"',$1,'"),b=b.split("{%").join("');"),b=b.split("%}").join("a.push('"),b=u.format(b);f.functions[a]=new Function(b)}this.type=a;this.element=c};f.prototype.render=function(a){f.temp.innerHTML=f.functions[this.type].call(a);return Array.apply(null,f.temp.childNodes)};f.functions={};f.temp=e.createElement("div");var s=/\s{2,}/g,t=/\{%=(.*?)%\}/g,u="var a=[];a.push('{}');return a.join('');",p=d.Router=function(){this.route=[];k.addEventListener("hashchange",this.match.bind(this),!1)};p.prototype.match=
function(){var a=l.hash.split("#!/")[1];void 0!==a?(this.route=a.split("/"),void 0!==d.collections[this.route[0]]&&d.cache?d.collections[this.route[0]].show(this.route[1]):d.request.get({handle:this.route[0]})):l.hash=d.home};var m=d.Request=function(){this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",m.callback,!1)};m.prototype.get=function(a){e.body.classList.add("loading");this.xhr.open("GET",d.endpoint.format(a),!0);this.xhr.setRequestHeader("Accept","application/json");this.xhr.send(null)};
m.callback=function(){if(200===this.status){var a=JSON.parse(this.response);d.collections[a.handle]=new g(a);d.collections[a.handle].show(d.router.route[1])}else l.hash=d.home;e.body.classList.remove("loading")};d.request=new m;var g=d.Collection=function(a){this.id=a.id;this.handle=a.handle;this.title=a.title;this.type=a.type;this.template=new f(a.type);this.blocks=a.blocks.map(function(a){return new q(a)});this.sort(this.template.element.dataset.sort||"id")};g.prototype.clone=function(){return Object.create(this)};
g.prototype.show=function(a){var c=d.collection=a?this.search("handle",a):this,b=this.title,n=this.template;if(a){if(0===c.blocks.length)return l.hash="#!/{}".format(this.handle);b=c.blocks[0].title;n=c.blocks[0].template}for(;d.root.firstChild;)d.root.removeChild(d.root.firstChild);n.render(c).forEach(function(a){d.root.appendChild(a)});e.body.classList.remove(r);e.body.classList.add(r=n.type);e.title=d.title.spec.format(d.title.text,b)};g.prototype.search=function(a,c){var b=this.clone();b.blocks=
b.blocks.filter(function(b){return b.reduce(a)===c});return b};g.prototype.sort=function(a){var c=this.clone(),b=1;"-"===a[0]&&(a=a.substring(1),b=-1);c.blocks.sort(function(c,d){c=c.reduce(a);d=d.reduce(a);return(c<d?-1:c>d?1:0)*b});return c};var r,q=d.Block=function(a){for(var c in a)this[c]=a[c];this.time=new Date(a.time);this.template=new f(a.type)};q.prototype.reduce=function(a){a=a.split(".");var c=this[a[0]];if(void 0!==a[1])for(var b=1;b<a.length;b++)c=c[a[b]];return c};String.prototype.format=
function(a){var c=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(v,function(b,d,e){return a[d||e||c++]})};var v=/:(\w+)|\{([0-9])?\}/g;Date.prototype.format=function(a){var c=Date.ordinals,b=this.getDate(),d=this.getDay(),e=this.getMonth(),f=this.getFullYear(),h=this.getHours(),g=12<h?h-12:h,k=this.getMinutes(),l=this.getSeconds(),m={d:10>b?"0"+b:b,D:Date.days[d].substr(0,3),j:b,l:Date.days[d],N:d+1,S:3<b&&20>=b?c[0]:c[b%10]||c[0],w:d,F:Date.months[e],m:10>e?"0"+(e+1):e+1,
M:Date.months[e].substr(0,3),n:e+1,t:(new Date(f,e+1,0)).getDate(),Y:f,y:(""+f).substr(2,2),a:12>h?"am":"pm",A:12>h?"AM":"PM",g:g,G:h,h:10>g?"0"+g:g,H:10>h?"0"+h:h,i:10>k?"0"+k:k,s:10>l?"0"+l:l};return a.replace(w,function(a,b){return void 0!==m[a]?m[a]:b})};Date.ordinals=["th","st","nd","rd"];Date.days="Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ");Date.months="January February March April May June July August September October November December".split(" ");var w=/\\?([a-z])/gi;
void 0===f.temp.dataset&&Object.defineProperty(Element.prototype,"dataset",{get:function(){var a={};Array.apply(null,this.attributes).forEach(function(c){var b=c.name.split("-");void 0!==b[1]&&"data"===b[0]&&(a[b[1]]=c.value)});return a}})})(this);