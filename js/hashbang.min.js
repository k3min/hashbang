(function(f){var d=f.document,h=f.location,c=f.HB={version:"1.3.0",endpoint:"api/:handle",collections:{},cache:!0,main:function(a,b){this.home=a||d.getElementsByTagName("a")[0].hash;this.target=b||d.querySelector("[data-role=target]");this.title={text:d.title,spec:d.getElementsByTagName("title")[0].dataset.spec};this.router=new l;this.router.match()}},e=c.Template=function(a){this.type=a;void 0===e.templates[this.type]&&(a="template[data-type={}]".format(this.type),a=d.querySelector(a).innerHTML,
a=a.replace(s,""),a=a.replace(t,"',$1,'"),a=a.split("{%").join("');"),a=a.split("%}").join("a.push('"),e.templates[this.type]=u.format(a));this.source=e.templates[this.type]};e.prototype.render=function(a){e.placeholder.innerHTML=(new Function("data",this.source))(a);return Array.apply(null,e.placeholder.childNodes)};e.templates={};e.placeholder=d.createElement("div");var s=/\s{2,}/g,t=/\{%=(.*?)%\}/g,u="var a=[];a.push('{}');return a.join('');",l=c.Router=function(){this.route=[];f.addEventListener("hashchange",
this.match.bind(this),!1)};l.prototype.match=function(){var a=h.hash.split("#!/")[1];a?(this.route=a.split("/"),void 0!==c.collections[this.route[0]]&&c.cache?c.collections[this.route[0]].show(this.route[1]):c.request.get({handle:this.route[0]})):h.hash=c.home};var k=c.Request=function(){this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",k.callback,!1)};k.prototype.get=function(a){d.body.classList.add("loading");this.xhr.open("GET",c.endpoint.format(a),!0);this.xhr.setRequestHeader("Accept",
"application/json");this.xhr.send(null)};k.callback=function(){if(200===this.status){var a=JSON.parse(this.response);c.collections[a.handle]=new n(a);c.collections[a.handle].show(c.router.route[1])}else h.hash=c.home;d.body.classList.remove("loading")};c.request=new k;var n=c.Collection=function(a){for(var b in a)this[b]=a[b];this.blocks=a.blocks.map(function(a){return new v(a)});this.template=new e(a.type)};n.prototype.show=function(a){var b=c.collection=this;if(a)if(b=this.blocks.filter(function(b){return b.handle===
a}),b.length)b={title:b[0].title,template:b[0].template,blocks:b};else return h.hash="#!/{}".format(this.handle);for(;c.target.firstChild;)c.target.removeChild(c.target.firstChild);b.template.render(b).forEach(function(a){c.target.appendChild(a)});d.body.classList.remove(p);d.body.classList.add(p=b.template.type);d.title=c.title.spec.format(c.title.text,b.title)};var p,v=c.Block=function(a){for(var b in a)this[b]=a[b];this.time=new Date(a.time);this.template=new e(a.type)};String.prototype.format=
function(a){var b=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(w,function(c,d,e){return a[d||e||b++]})};var w=/:(\w+)|\{([0-9])?\}/g;Date.prototype.format=function(a){var b=this.getDate(),c=this.getDay(),d=this.getMonth(),e=this.getFullYear(),g=this.getHours(),f=12<g?g-12:g,h=this.getMinutes(),k=this.getSeconds(),l={d:10>b?"0"+b:b,D:q[c].substr(0,3),j:b,l:q[c]+"day",N:c+1,S:3<b&&21>b?m[0]:m[b%10]||m[0],w:c,F:r[d],m:10>d?"0"+d:d,M:r[d].substr(0,3),n:d+1,Y:e,y:(""+e).substr(2,
2),a:12>g?"am":"pm",A:12>g?"AM":"PM",g:f,G:g,h:10>f?"0"+f:f,H:10>g?"0"+g:g,i:10>h?"0"+h:h,s:10>k?"0"+k:k};return a.replace(/\\?([a-z])/gi,function(a,b){return void 0!==l[a]?l[a]:b})};var m=["th","st","nd","rd"],q="Mon Tues Wednes Thurs Fri Satur Sun".split(" "),r="January February March April May June July August September October November December".split(" ")})(this);