(function(k){var c=k.document,e=k.location,b=k.HB={version:"1.3.1",endpoint:"api/:handle",collections:{},cache:!0,main:function(a,f){this.home=a||c.getElementsByTagName("a")[0].hash;this.target=f||c.querySelector("[data-role=target]");this.title={text:c.title,spec:c.getElementsByTagName("title")[0].dataset.spec};this.router=new l;this.router.match()}},d=b.Template=function(a){this.type=a;void 0===d.templates[this.type]&&(a="template[data-type={}]".format(this.type),a=c.querySelector(a).innerHTML,
a=a.replace(u,""),a=a.replace(v,"',$1,'"),a=a.split("{%").join("');"),a=a.split("%}").join("a.push('"),a=w.format(a),d.templates[this.type]=new Function("data",a));this.method=d.templates[this.type]};d.prototype.render=function(a){d.placeholder.innerHTML=this.method(a);return Array.apply(null,d.placeholder.childNodes)};d.templates={};d.placeholder=c.createElement("div");var u=/\s{2,}/g,v=/\{%=(.*?)%\}/g,w="var a=[];a.push('{}');return a.join('');",l=b.Router=function(){this.route=[];k.addEventListener("hashchange",
this.match.bind(this),!1)};l.prototype.match=function(){var a=e.hash.split("#!/")[1];void 0!==a?(this.route=a.split("/"),void 0!==b.collections[this.route[0]]&&b.cache?b.collections[this.route[0]].show(this.route[1]):b.request.get({handle:this.route[0]})):e.hash=b.home};var h=b.Request=function(){this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",h.callback,!1)};h.prototype.get=function(a){c.body.classList.add("loading");this.xhr.open("GET",b.endpoint.format(a),!0);this.xhr.setRequestHeader("Accept",
"application/json");this.xhr.send(null)};h.callback=function(){if(200===this.status){var a=JSON.parse(this.response);b.collections[a.handle]=new q(a);b.collections[a.handle].show(b.router.route[1])}else e.hash=b.home;c.body.classList.remove("loading")};b.request=new h;var q=b.Collection=function(a){this.id=a.id;this.handle=a.handle;this.title=a.title;this.type=a.type;this.template=new d(a.type);this.blocks=a.blocks.map(function(a){return new x(a)})};q.prototype.show=function(a){var f=b.collection=
Object.create(this),d=this.title,m=this.template;if(void 0!==a){f.blocks=this.blocks.filter(function(b){return b.handle===a});if(0===f.blocks.length)return e.hash="#!/{}".format(this.handle);1===f.blocks.length&&(d=f.blocks[0].title,m=f.blocks[0].template)}else f.blocks=this.blocks.filter(function(a){return!a.hidden});for(;b.target.firstChild;)b.target.removeChild(b.target.firstChild);m.render(f).forEach(function(a){b.target.appendChild(a)});c.body.classList.remove(r);c.body.classList.add(r=m.type);
c.title=b.title.spec.format(b.title.text,d)};var r,x=b.Block=function(a){for(var b in a)this[b]=a[b];this.time=new Date(a.time);this.template=new d(a.type)};String.prototype.format=function(a){var b=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(y,function(d,m,c){return a[m||c||b++]})};var y=/:(\w+)|\{([0-9])?\}/g;Date.prototype.format=function(a){var b=this.getDate(),d=this.getDay(),c=this.getMonth(),k=this.getFullYear(),g=this.getHours(),e=12<g?g-12:g,h=this.getMinutes(),
n=this.getSeconds(),l={d:10>b?"0"+b:b,D:s[d].substr(0,3),j:b,l:s[d]+"day",N:d+1,S:3<b&&21>b?p[0]:p[b%10]||p[0],w:d,F:t[c],m:10>c?"0"+c:c,M:t[c].substr(0,3),n:c+1,Y:k,y:(""+k).substr(2,2),a:12>g?"am":"pm",A:12>g?"AM":"PM",g:e,G:g,h:10>e?"0"+e:e,H:10>g?"0"+g:g,i:10>h?"0"+h:h,s:10>n?"0"+n:n};return a.replace(z,function(a,b){return void 0!==l[a]?l[a]:b})};var z=/\\?([a-z])/gi,p=["th","st","nd","rd"],s="Mon Tues Wednes Thurs Fri Satur Sun".split(" "),t="January February March April May June July August September October November December".split(" ")})(this);