(function(h){var e=h.document,k=h.location,c=h.HB={version:"1.3.3",endpoint:"api/:handle",collections:{},cache:!0,main:function(a,b){this.home=a||e.getElementsByTagName("a")[0].hash;this.root=b||e.querySelector("[data-role=root]");this.title={text:e.title,spec:e.getElementsByTagName("title")[0].dataset.spec};this.router=new p;this.router.match()}},f=c.Template=function(a){var b="template[data-type={}]".format(a),b=e.querySelector(b);if(void 0===f.functions[a]){var d=b.innerHTML,d=d.replace(s,""),
d=d.replace(t,"',$1,'"),d=d.split("{%").join("');"),d=d.split("%}").join("a.push('"),d=u.format(d);f.functions[a]=new Function(d)}this.type=a;this.element=b};f.prototype.render=function(a){f.placeholder.innerHTML=f.functions[this.type].call(a);return Array.apply(null,f.placeholder.childNodes)};f.functions={};f.placeholder=e.createElement("div");var s=/\s{2,}/g,t=/\{%=(.*?)%\}/g,u="var a=[];a.push('{}');return a.join('');",p=c.Router=function(){this.route=[];h.addEventListener("hashchange",this.match.bind(this),
!1)};p.prototype.match=function(){var a=k.hash.split("#!/")[1];void 0!==a?(this.route=a.split("/"),void 0!==c.collections[this.route[0]]&&c.cache?c.collections[this.route[0]].show(this.route[1]):c.request.get({handle:this.route[0]})):k.hash=c.home};var l=c.Request=function(){this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",l.callback,!1)};l.prototype.get=function(a){e.body.classList.add("loading");this.xhr.open("GET",c.endpoint.format(a),!0);this.xhr.setRequestHeader("Accept","application/json");
this.xhr.send(null)};l.callback=function(){if(200===this.status){var a=JSON.parse(this.response);c.collections[a.handle]=new m(a);c.collections[a.handle].show(c.router.route[1])}else k.hash=c.home;e.body.classList.remove("loading")};c.request=new l;var m=c.Collection=function(a){var b;this.id=a.id;this.handle=a.handle;this.title=a.title;this.type=a.type;this.template=new f(a.type);this.blocks=a.blocks.map(function(a){return new q(a)});Object.defineProperty(this,"sortBy",{enumerable:!0,get:function(){return b},
set:function(a){var c=1;b=a;"-"===a[0]&&(a=a.substring(1),c=-1);this.blocks.sort(function(b,g){b=b.reduce(a);g=g.reduce(a);return(b<g?-1:b>g?1:0)*c})}});this.sortBy=this.template.element.dataset.sort||"id"};m.prototype.clone=function(){return Object.create(this)};m.prototype.show=function(a){for(var b=c.collection=a?this.clone():this,d=this.title,n=this.template;c.root.firstChild;)c.root.removeChild(c.root.firstChild);if(a){b.blocks=this.search("handle",a);if(0===b.blocks.length)return k.hash="#!/{}".format(this.handle);
d=b.blocks[0].title;n=b.blocks[0].template}n.render(b).forEach(function(a){c.root.appendChild(a)});e.body.classList.remove(r);e.body.classList.add(r=n.type);e.title=c.title.spec.format(c.title.text,d)};m.prototype.search=function(a,b){return this.blocks.filter(function(d){return-1!==b.indexOf(d.reduce(a))})};var r,q=c.Block=function(a){for(var b in a)this[b]=a[b];this.time=new Date(a.time);this.template=new f(a.type)};q.prototype.reduce=function(a){a=a.split(".");var b=this[a[0]];if(void 0!==a[1])for(var d=
1;d<a.length;d++)b=b[a[d]];return b};String.prototype.format=function(a){var b=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(v,function(d,c,e){return a[c||e||b++]})};var v=/:(\w+)|\{([0-9])?\}/g;Date.prototype.format=function(a){var b=this.getDate(),d=this.getDay(),c=this.getMonth(),e=this.getFullYear(),g=this.getHours(),f=12<g?g-12:g,h=this.getMinutes(),k=this.getSeconds(),l={d:10>b?"0"+b:b,D:Date.days[d].substr(0,3),j:b,l:Date.days[d],N:d+1,S:3<b&&20>=b?Date.ordinals[0]:
Date.ordinals[b%10]||Date.ordinals[0],w:d,F:Date.months[c],m:10>c?"0"+(c+1):c+1,M:Date.months[c].substr(0,3),n:c+1,t:(new Date(e,c+1,0)).getDate(),Y:e,y:(""+e).substr(2,2),a:12>g?"am":"pm",A:12>g?"AM":"PM",g:f,G:g,h:10>f?"0"+f:f,H:10>g?"0"+g:g,i:10>h?"0"+h:h,s:10>k?"0"+k:k};return a.replace(w,function(a,b){return void 0!==l[a]?l[a]:b})};Date.ordinals=["th","st","nd","rd"];Date.days="Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ");Date.months="January February March April May June July August September October November December".split(" ");
var w=/\\?([a-z])/gi;void 0===f.placeholder.dataset&&Object.defineProperty(Element.prototype,"dataset",{get:function(){var a={};Array.apply(null,this.attributes).forEach(function(b){var c=b.name.split("-");void 0!==c[1]&&"data"===c[0]&&(a[c[1]]=b.value)});return a}})})(this);