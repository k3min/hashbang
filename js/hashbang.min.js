(function(h){var e=h.document,k=h.location,b=h.HB={version:"1.2.4",endpoint:"api/:handle",collections:{},cache:!0,main:function(a,d){this.home=a||e.getElementsByTagName("a")[0].hash;this.target=d||e.querySelector("[data-role=target]");this.title={text:e.title,spec:e.getElementsByTagName("title")[0].dataset.spec};this.router=new p;this.router.match()}},c=b.Template=function(a){this.type=a;if(void 0===c.templates[this.type]){var d;a="template[data-type={}]".format(this.type);try{d=e.querySelector(a).innerHTML}catch(b){throw Error("Template '{}' does not exist!".format(this.type));
}c.templates[this.type]=d.replace(u,"")}this.source=c.templates[this.type]};c.prototype.render=function(a){c.placeholder.innerHTML=this.source.replace(c.regex,c.replacer.bind(a));return Array.apply(null,c.placeholder.childNodes)};c.regex=/\{([\w\.]+)\}/g;c.templates={};c.placeholder=e.createElement("div");c.replacer=function(a,d){return d.split(".").reduce(function(a,d){return a[d]},this)};var u=/\s{2,}/g,p=b.Router=function(){this.route=[];h.addEventListener("hashchange",this.match.bind(this),!1)};
p.prototype.match=function(){var a=k.hash.split("#!/")[1];if(void 0===a)return k.hash=b.home;this.route=a.split("/");void 0!==b.collections[this.route[0]]&&b.cache?b.collections[this.route[0]].show(this.route[1]):b.request.get({handle:this.route[0]})};var m=b.Request=function(){this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",m.callback,!1)};m.prototype.get=function(a){e.body.classList.add("loading");this.xhr.open("GET",b.endpoint.format(a),!0);this.xhr.setRequestHeader("Accept","application/json");
this.xhr.send(null)};m.callback=function(){if(200===this.status){var a=JSON.parse(this.response);b.collections[a.handle]=new f(a);b.collections[a.handle].show(b.router.route[1])}else k.hash=b.home;e.body.classList.remove("loading")};b.request=new m;var f=b.Collection=function(a){this.blocks={};this.id=a.id;this.handle=a.handle;this.title=a.title;this.showTitle=a.showTitle;this.template=new c(a.type);for(var d in a.blocks)this.blocks[d]=new q(a.blocks[d])};f.prototype.show=function(a){if(void 0!==
a&&void 0===this.blocks[a])return k.hash="#!/{}".format(this.handle);for(var d=this.title,c=this.template.type;b.target.firstChild;)b.target.removeChild(b.target.firstChild);if(void 0!==a){var l=this.blocks[a],d=l.title,c=l.template.type;l.show()}else for(l in this.showTitle&&(f.title.textContent=this.title,b.target.appendChild(f.title)),this.blocks)this.blocks.hasOwnProperty(l)&&this.blocks[l].show(this.template);e.title=b.title.spec.format(b.title.text,d);e.body.classList.remove(r);e.body.classList.add(c);
r=c};f.title=e.createElement("h1");var r,q=b.Block=function(a){for(var d in a)this[d]=a[d];this.template=new c(a.type)};q.prototype.show=function(a){(a||this.template).render(this).forEach(function(a){var c=a.querySelectorAll("[data-spec]");c.length&&Array.apply(null,c).forEach(function(a){a.textContent=(new Date(a.textContent)).format(a.dataset.spec)});b.target.appendChild(a)})};String.prototype.format=function(a){var d=0;a="string"===typeof a?Array.apply(null,arguments):a;return this.replace(v,
function(b,c,e){return a[c||e||d++]})};var v=/:(\w+)|\{([0-9])?\}/g;Date.prototype.format=function(a){var d=this.getDate(),b=this.getDay(),c=this.getMonth(),e=this.getFullYear(),g=this.getHours(),f=12<g?g-12:g,h=this.getMinutes(),k=this.getSeconds(),m={d:10>d?"0"+d:d,D:s[b].substr(0,3),j:d,l:s[b]+"day",N:b+1,S:3<d&&21>d?n[0]:n[d%10]||n[0],w:b,F:t[c],m:10>c?"0"+c:c,M:t[c].substr(0,3),n:c+1,Y:e,y:(""+e).substr(2,2),a:12>g?"am":"pm",A:12>g?"AM":"PM",g:f,G:g,h:10>f?"0"+f:f,H:10>g?"0"+g:g,i:10>h?"0"+h:
h,s:10>k?"0"+k:k};return a.replace(/\\?([a-z])/gi,function(a,b){return m[a]||b})};var n=["th","st","nd","rd"],s="Mon Tues Wednes Thurs Fri Satur Sun".split(" "),t="January February March April May June July August September October November December".split(" ")})(this);