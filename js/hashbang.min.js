(function(f){var e=f.document,t=f.location,h=e.documentElement,k=Object.defineProperty,m=Object.create,v=function(a){var b=navigator.appVersion;return/Trident/.test(b)&&b.match(/Trident\/([0-9])/)[1]<=a},d=f.HB={version:"2.0.6",endpoint:"api/:handle",collections:{},main:function(a,b){d.request=new z(d.endpoint);d.home=a||e.links[0].hash;d.root=b||f.root;d.title={text:e.title,spec:e.getElementsByTagName("title")[0].dataset.spec};d.router.fallback=d.fallback;d.router.add("/:collection(/:block)?",function(a,
b){var g=d.collections[a];void 0===g||void 0===g.blocks||d.noCache?(g=d.collections[a]=new A,g.addEventListener("update",d.update),d.request.get({handle:a,success:g.load.bind(g),error:d.fallback})):d.request.xhr.abort();g.block=b;u.forEach(function(a){a.classList.remove("active")});u=[];for(var g=0,f=e.links;g<f.length;g++)f[g].hash.substr(3)===a&&(f[g].classList.add("active"),u.push(f[g]))});d.router.match()},update:function(a){a=a.detail;var b=d.title,c=d.root,l=h.classList;for(e.title=b.spec.format(b.text,
a.title);c.firstChild;)c.removeChild(c.firstChild);c.appendChild(this);l.remove(w);l.add(w=a.handle);l.remove(x);l.add(x=a.type);c.dispatchEvent(new CustomEvent("update",{detail:this}))},fallback:function(){t.hash=d.home}},u=[],w,x,n=f.klass=function(a){var b=a.constructor,c=this&&this.prototype||!1;c&&(b.prototype=m(c,{parent:{value:c}}));for(var l in a){var c=a[l],d=l.split("$")[0],f=/\$static/.test(l)?b:b.prototype,e={enumerable:!/\$hidden|^constructor/.test(l)};null===c||"function"!==typeof c.get&&
"function"!==typeof c.set?(e.value=c,e.writable="function"!==typeof c):(e.get=c.get,e.set=c.set);k(f,d,e)}return b};k(Object.prototype,"extend",{value:n});if(void 0===e.registerElement){var q={},y=function(a,b){v(6)?Object.getOwnPropertyNames(b).forEach(function(c){k(a,c,Object.getOwnPropertyDescriptor(b,c))}):a.__proto__=b};e.registerElement=function(a,b){q[a]=b;var c=function(){var c=e.createElement(a);y(c,b.prototype);return c};c.prototype=b.prototype;k(c.prototype,"constructor",{value:c});return c};
e.addEventListener("DOMContentLoaded",function(){for(var a in q){var b;b=q[a]["extends"];b=void 0!==b?e.querySelectorAll("{}[is={}]".format(b,a)):e.getElementsByTagName(a);for(var c=0;c<b.length;c++)y(b[c],q[a].prototype),void 0!==b[c].attachedCallback&&b[c].attachedCallback.call(b[c])}})}void 0===f.HTMLTemplateElement&&(f.HTMLTemplateElement=HTMLElement.extend({constructor:function(){console.error("Illegal constructor")}}));d.Template=e.registerElement("hb-template",{prototype:m(HTMLTemplateElement.prototype,
{attachedCallback:{value:function(){var a=this.innerHTML,a=a.replace(/\s{2,}/g,""),a=a.replace(/\{\{(.*?)\}\}/g,"',$1,'"),a=a.split("{%").join("');"),a=a.split("%}").join("a.push('"),a="var a=[];a.push('"+a+"');return a.join('');";this.range=e.createRange();this.source=new Function(a)}},render:{value:function(a){this.range.selectNode(e.body);return this.range.createContextualFragment(this.source.call(a))}}}),"extends":"template"});var A=d.Collection=e.registerElement("hb-collection",{prototype:m(HTMLElement.prototype,
{load:{value:function(a){this.id=a.id;this.handle=a.handle;this.title=a.title;this.description=a.description;this.type=a.type;this.url=a.url;this.template=f[a.type]||f.collection||f["default"];this.blocks=a.blocks.map(function(a){return new B(a)});void 0!==this.template.dataset.sort?this.sort(this.template.dataset.sort):this.update()}},id:{get:function(){return this._id},set:function(a){this._id=a}},title:{get:function(){return this._title},set:function(a){this._title=a}},block:{get:function(){return this._block},
set:function(a){this._block=a;void 0!==this.blocks&&this.update()}},sort:{value:function(a){var b="-"===a[0]?(a=a.substr(1),-1):1;this.blocks.sort(function(c,d){c=c.reduce(a);d=d.reduce(a);return(c<d?-1:c>d?1:0)*b});this.update()}},search:{value:function(a,b){var c=m(this);c.blocks=c.blocks.filter(function(c){return c.reduce(a)===b});return c}},update:{value:function(){var a=void 0===this._block?this:this.search("handle",this._block),b={id:this.id,handle:this.handle,title:this.title,type:this.type,
template:this.template};if(void 0!==this._block){b=a.blocks[0];if(void 0===b)return t.hash="#!/"+this.handle;b={id:b.id,handle:b.handle,title:b.title,type:b.type,template:b.template}}if(void 0===b.template)return a="Template #{} is not defined".format(b.type),console.error(a);for(;this.firstChild;)this.removeChild(this.firstChild);this.appendChild(b.template.render(a));this.dispatchEvent(new CustomEvent("update",{detail:b}))}}})}),B=d.Block=n({constructor:function(a){for(var b in a)this[b]=a[b];this.time=
new Date(this.time);this.template=f[this.type]||f.block||f["default"]},reduce:function(a){a=a.split(".");var b=this[a[0]];if(void 0!==a[1])for(var c=1;c<a.length;c++)b=b[a[c]];return b}}),C=d.Router=n({constructor:function(){f.addEventListener("hashchange",this.match.bind(this))},add$hidden:function(a,b){var c=/\((\/:[a-z]+)\)\?/g;c.test(a)&&(a=a.replace(c,"(?:$1)?"));c=new RegExp(a.replace(/:[a-z]+/g,"([a-z0-9-]+)"));this[a]=b;this[a].regExp=c},match$hidden:function(){var a=!0,b;for(b in this)if("fallback"!==
b){var c=t.hash.match(this[b].regExp);null!==c&&(c.shift(),this[b].apply(this,c),a=!1)}a&&void 0!==this.fallback&&this.fallback()}});d.router=new C;var z=d.Request=n({constructor:function(a){this.endpoint=a;this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",this.load.bind(this))},get:function(a){h.classList.add("loading");this.accept=a.accept||"application/json";this.success=a.success;this.error=a.error;this.response=a.response||"json";this.xhr.open("GET",this.endpoint.format(a));this.xhr.responseType=
this.response;this.xhr.setRequestHeader("Accept",this.accept);this.xhr.send()},load:function(){try{var a=this.xhr.response;200===this.xhr.status?"function"===typeof this.success&&this.success(a):"function"===typeof this.error&&this.error(a)}catch(b){b.status=-1,"function"===typeof this.error?this.error(b):console.error(b)}finally{h.classList.remove("loading")}}});String.prototype.format=function(a){var b=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(/:([a-z]+)|\{([0-9])?\}/g,
function(c,d,e){return a[d||e||b++]})};Date.prototype.format=function(a){var b=Date.ordinals,c=Date.days,d=Date.months,e=this.getDate(),f=this.getDay(),p=this.getMonth(),k=this.getFullYear(),r=this.getHours(),h=r%12||12,m=this.getMinutes(),n=this.getSeconds(),q={d:10>e?"0"+e:e,D:c[f].substr(0,3),j:e,l:c[f],N:f||7,S:3<e&&20>=e?b[0]:b[e%10]||b[0],w:f,F:d[p],m:10>p?"0"+(p+1):p+1,M:d[p].substr(0,3),n:p+1,t:(new Date(k,p+1,0)).getDate(),Y:k,y:(""+k).substr(2,2),a:12>r?"am":"pm",A:12>r?"AM":"PM",g:h,G:r,
h:10>h?"0"+h:h,H:10>r?"0"+r:r,i:10>m?"0"+m:m,s:10>n?"0"+n:n};return a.replace(/\\?([a-z])/gi,function(a,b){return void 0!==q[a]?q[a]:b})};Date.ordinals=["th","st","nd","rd"];Date.days="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");Date.months="January February March April May June July August September October November December".split(" ");void 0===h.dataset&&k(HTMLElement.prototype,"dataset",{get:function(){for(var a={},b=this.attributes,c=0;c<b.length;c++){var d=b[c].name.split("-");
void 0!==d[1]&&"data"===d[0]&&(a[d[1]]=b[c].value)}return a}});v(7)&&(f.CustomEvent=Event.extend({constructor:function(a,b){var c=e.createEvent("CustomEvent");c.initCustomEvent(a,!1,!1,b.detail);return c}}))})(this);