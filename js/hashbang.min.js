(function(g){var f=g.document,r=g.location,h=f.documentElement,u=Object.defineProperty,k=Object.create,v=function(a){var b=navigator.appVersion;return/Trident/.test(b)&&(b.match(/Trident\/(\d)/)[1]|0)<=a},e=g.HB={version:"2.0.8",endpoint:"api/:handle",collections:{},main:function(a,b){e.request=new z(e.endpoint);e.home=a||f.links[0].hash;e.root=b||g.root;e.title={text:f.title,spec:f.getElementsByTagName("title")[0].dataset.spec};e.router.fallback=e.fallback;e.router.add("/:collection(/:block)?",e.route);
e.router.match()},route:function(a,b){var c=e.collections[a];void 0===c||void 0===c.blocks||e.noCache?(c=e.collections[a]=new A,c.addEventListener("update",e.update,!1),e.request.get({handle:a,success:c.load.bind(c),error:e.fallback})):e.request.xhr.abort();c.block=b;t.forEach(function(a){a.classList.remove("active")});t=[];for(var c=0,d=f.links;c<d.length;c++)d[c].hash.substr(3)===a&&(d[c].classList.add("active"),t.push(d[c]))},update:function(a){a=a.detail;var b=e.title,c=e.root,d=h.classList;f.title=
b.spec.format(b.text,a.title);c.replaceChildren(this);d.remove(w);d.add(w=a.handle);d.remove(x);d.add(x=a.type);c.dispatchEvent(new CustomEvent("update",{detail:this}))},fallback:function(){r.hash=e.home}},t=[],w,x,B="configurable enumerable value writable get set".split(" "),C=function(a){return Object.keys(a).some(function(a){return-1!==B.indexOf(a)})};u(Object.prototype,"define",{value:function(a,b,c){b="object"===typeof b&&C(b)?b:{value:b,writable:c||!1};return u(this,a,b)}});var m=g.klass=function(a){var b=
a.constructor,c=a.prototype,d=this&&this.prototype||!1;if(void 0!==c||!1!==d)b.prototype=c||k(d,{parent:{value:d}});for(var e in a)if(d=a[e],d!==c){var f=e.split("$")[0],g=/\$static/.test(e)?b:b.prototype,l={enumerable:!/\$private|^constructor/.test(e)};null===d||"function"!==typeof d.get&&"function"!==typeof d.set?(l.value=d,l.writable=/\$virtual/.test(e)||"function"!==typeof d):(l.get=d.get,l.set=d.set);g.define(f,l)}return b};Object.prototype.define("extend",m);if(void 0===f.registerElement){var n=
{},y=function(a,b){void 0===a.registerFlags&&a.define("registerFlags",0,!0);var c=void 0!==b["extends"]?2:1;if(a.registerFlags&c)return!1;var d=b.prototype;v(7)?Object.getOwnPropertyNames(d).forEach(function(b){a.define(b,Object.getOwnPropertyDescriptor(d,b))}):a.__proto__=d;a.registerFlags|=c;return!0};f.define("registerElement",function(a,b){n[a]=b;return m({constructor:function(){var c=f.createElement(a);y(c,b);return c},prototype:b.prototype})});var q=function(){for(var a in n){var b;b=n[a]["extends"];
b=void 0!==b?f.querySelectorAll("{}[is={}]".format(b,a)):f.getElementsByTagName(a);for(var c=0;c<b.length;c++){var d=b[c];y(d,n[a])&&"function"===typeof d.attachedCallback&&d.attachedCallback.call(d)}}};try{(new MutationObserver(q)).observe(f,{childList:!0,subtree:!0})}catch(a){f.addEventListener("DOMContentLoaded",q,!1)}}void 0===g.HTMLTemplateElement&&g.define("HTMLTemplateElement",HTMLElement.extend({constructor:function(){throw new TypeError("Illegal constructor");}}));e.Template=f.registerElement("hb-template",
{prototype:k(HTMLTemplateElement.prototype,{attachedCallback:{value:function(){var a=this.innerHTML,a=a.replace(/\s{2,}/g,""),a=a.replace(/\{\{(.*?)\}\}/g,"',$1,'"),a=a.split("{%").join("');"),a=a.split("%}").join("a.push('"),a="var a=[];a.push('"+a+"');return a.join('');";this.define("range",f.createRange());this.define("source",new Function(a))}},render:{value:function(a){var b,c=this.source.call(a);this.range.selectNode(f.body);try{b=this.range.createContextualFragment(c)}catch(d){for(a=f.createElement("div"),
a.innerHTML=c,b=f.createDocumentFragment();c=a.firstChild;)b.appendChild(c)}return b}}}),"extends":"template"});var A=e.Collection=f.registerElement("hb-collection",{prototype:k(HTMLElement.prototype,{load:{value:function(a){this.id=a.id;this.handle=a.handle;this.title=a.title;this.description=a.description;this.type=a.type;this.url=a.url;this.template=g[a.type]||g.collection||g["default"];this.blocks=a.blocks.map(function(a){return new D(a)});void 0!==this.template.dataset.sort?this.sort(this.template.dataset.sort):
this.update()}},id:{get:function(){return this._id},set:function(a){this._id=a}},title:{get:function(){return this._title},set:function(a){this._title=a}},block:{get:function(){return this._block},set:function(a){this._block=a;void 0!==this.blocks&&this.update()}},sort:{value:function(a){var b="-"===a[0]?(a=a.substr(1),-1):1;this.blocks.sort(function(c,d){c=c.reduce(a);d=d.reduce(a);return(c<d?-1:c>d?1:0)*b});this.update()}},search:{value:function(a,b){var c=k(this);c.blocks=c.blocks.filter(function(c){return c.reduce(a)===
b});return c}},update:{value:function(){var a=void 0===this._block?this:this.search("handle",this._block),b={id:this.id,handle:this.handle,title:this.title,type:this.type,template:this.template};if(void 0!==this._block){b=a.blocks[0];if(void 0===b)return r.hash="#!/"+this.handle;b={id:b.id,handle:b.handle,title:b.title,type:b.type,template:b.template}}if(void 0===b.template)return a="Template #{} is not defined".format(b.type),console.error(a);this.replaceChildren(b.template.render(a));this.dispatchEvent(new CustomEvent("update",
{detail:b}))}}})}),D=e.Block=m({constructor:function(a){for(var b in a)this[b]=a[b];this.time=new Date(a.time);this.template=g[a.type]||g.block||g["default"]},reduce:function(a){a=a.split(".");var b=this[a[0]];if(void 0!==a[1])for(var c=1;c<a.length;c++)b=b[a[c]];return b}}),q=e.Router=m({constructor:function(a){this.fallback=a||null;g.addEventListener("hashchange",this.match.bind(this))},add$private:function(a,b){var c=a,d=/\((\/:[a-z]+)\)\?/g;d.test(a)&&(a=a.replace(d,"(?:$1)?"));d=new RegExp(a.replace(/:[a-z]+/g,
"([a-z0-9-]+)"),"i");this[c]=b;this[c].regExp=d},match$private:function(){var a=!0,b;for(b in this)if("fallback"!==b){var c=r.hash.match(this[b].regExp);null!==c&&(c.shift(),this[b].apply(this,c),a=!1)}a&&"function"===typeof this.fallback&&this.fallback()}});e.router=new q;var z=e.Request=m({constructor:function(a){this.endpoint=a;this.define("xhr",new XMLHttpRequest);this.define("accept","",!0);this.define("response","",!0);this.xhr.addEventListener("load",this.load.bind(this));this.xhr.addEventListener("error",
this.fallback.bind(this))},send:function(a){var b=a.method,c=a.data||null;this.accept=a.accept||"application/json";this.response=a.response||"json";h.classList.add("loading");this.success=a.success;this.error=a.error;this.xhr.open(b,this.endpoint.format(a));this.xhr.responseType=this.response;this.xhr.setRequestHeader("Accept",this.accept);"GET"!==b&&null!==c&&(a=a.type||"application/json",this.xhr.setRequestHeader("Content-Type",a),"application/json"===a&&(c=JSON.stringify(c)));this.xhr.send(c)},
get:function(a){a.method="GET";this.send(a)},load:function(){h.classList.remove("loading");try{var a=this.xhr.response;"json"===this.response&&"object"!==typeof a&&(a=JSON.parse(a));200===this.xhr.status?"function"===typeof this.success&&this.success(a):this.fallback(a)}catch(b){this.fallback(b)}},fallback:function(a){h.classList.remove("loading");void 0===a||null===a?a={status:this.xhr.status,message:this.xhr.statusText}:void 0===a.status&&(a.status=-1);"function"===typeof this.error&&this.error(a);
this.debug&&console.error(a)}});void 0===g.HTMLDialogElement&&(g.define("HTMLDialogElement",HTMLElement.extend({returnValue:"",constructor:function(){throw new TypeError("Illegal constructor");},open:{get:function(){return this.hasAttribute("open")},set:function(a){a?this.setAttribute("open",""):this.removeAttribute("open")}},show:function(){this.open=!0},close:function(a){void 0!==a&&(this.returnValue=a);this.dispatchEvent(new CustomEvent("close"));this.open=!1;this.returnValue=""}})),f.registerElement("dialog",
{prototype:k(HTMLDialogElement.prototype)}));Node.prototype.define("replaceChildren",function(a){for(;this.firstChild;)this.removeChild(this.firstChild);this.appendChild(a)});String.prototype.define("format",function(a){var b=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(/:([a-z]+)|\{([0-9])?\}/g,function(c,d,e){return a[d||e||b++]})});Date.prototype.define("format",function(a){var b=Date.ordinals,c=Date.days,d=Date.months,e=this.getDate(),f=this.getDay(),g=this.getMonth(),
l=this.getFullYear(),p=this.getHours(),h=p%12||12,k=this.getMinutes(),m=this.getSeconds(),n={d:10>e?"0"+e:e,D:c[f].substr(0,3),j:e,l:c[f],N:f||7,S:3<e&&20>=e?b[0]:b[e%10]||b[0],w:f,F:d[g],m:10>g?"0"+(g+1):g+1,M:d[g].substr(0,3),n:g+1,t:(new Date(l,g+1,0)).getDate(),Y:l,y:(""+l).substr(2,2),a:12>p?"am":"pm",A:12>p?"AM":"PM",g:h,G:p,h:10>h?"0"+h:h,H:10>p?"0"+p:p,i:10>k?"0"+k:k,s:10>m?"0"+m:m};return a.replace(/\\?([a-z])/gi,function(a,b){return void 0!==n[a]?n[a]:b})});Date.ordinals=["th","st","nd",
"rd"];Date.days="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");Date.months="January February March April May June July August September October November December".split(" ");void 0===h.dataset&&HTMLElement.prototype.define("dataset",{get:function(){for(var a={},b=0,c=this.attributes;b<c.length;b++){var d=c[b].name.split("-");void 0!==d[1]&&"data"===d[0]&&(a[d[1]]=c[b].value)}return a}});if(void 0===h.classList){var E=Array.extend({constructor:function(a){this.push.apply(this,
a.className.split(" "));this.define("element",a)},update$private:function(){this.element.className=this.toString()},add:function(a){-1===this.indexOf(a)&&(this.push(a),this.update())},remove:function(a){a=this.indexOf(a);-1!==a&&(this.splice(a,1),this.update())},toString:function(){return this.join(" ")}});HTMLElement.prototype.define("classList",{get:function(){return new E(this)}})}v(7)&&g.define("CustomEvent",Event.extend({constructor:function(a,b){var c=f.createEvent("CustomEvent");c.initCustomEvent(a,
!1,!1,b.detail);return c}}))})(this);