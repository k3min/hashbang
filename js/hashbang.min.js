(function(k){var b=k.HB={version:"1.2",endpoint:"api/:handle",collections:{},useCached:!0,main:function(a,b){this.home=a||document.getElementsByTagName("a")[0].hash;this.target=b||document.querySelector("[data-role=target]");this.title={text:document.title,spec:document.getElementsByTagName("title")[0].dataset.spec};this.router=new g;this.router.match()}},c=b.Template=function(a){this.type=a;void 0===c.templates[this.type]&&(a="script[data-type={}]".format(this.type),a=document.querySelector(a).text,
c.templates[this.type]=a.replace(l,""));this.source=c.templates[this.type]};c.prototype.render=function(a){c.placeholder.innerHTML=this.source.replace(c.regex,c.replacer.bind(a));return c.placeholder.childNodes[0]};c.regex=/\{([\w\.]+)\}/g;c.templates={};c.placeholder=document.createElement("div");c.replacer=function(a,b){return b.split(".").reduce(function(a,b){return a[b]},this)};var l=/\s{2,}/g,g=b.Router=function(){this.route=[];addEventListener("hashchange",this.match.bind(this),!1)};g.prototype.match=
function(){this.route=location.hash.split("#!/")[1];if(void 0===this.route)return location.hash=b.home;this.route=this.route.split("/");void 0!==b.collections[this.route[0]]&&b.useCached?b.collections[this.route[0]].show(this.route[1]):b.request.get({handle:this.route[0]})};var d=b.Request=function(){this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",d.callback,!1)};d.prototype.get=function(a){document.body.classList.add("loading");this.xhr.open("GET",b.endpoint.format(a),!0);this.xhr.send(null)};
d.callback=function(){if(200===this.status){var a=JSON.parse(this.response);b.collections[a.handle]=new f(a);b.collections[a.handle].show(b.router.route[1])}else return location.hash=b.home;document.body.classList.remove("loading")};b.request=new d;var f=b.Collection=function(a){this.blocks={};this.id=a.id;this.handle=a.handle;this.title=a.title;this.type=a.type;this.showTitle=a.showTitle;this.template=new c(this.type);for(var b in a.blocks)this.blocks[b]=new h(a.blocks[b])};f.prototype.show=function(a){for(var c=
this.title,d=this.type,m=[document.body,b.target];b.target.firstChild;)b.target.removeChild(b.target.firstChild);if(a)if(void 0!==this.blocks[a]){var e=this.blocks[a],c=e.title,d=e.type;e.show()}else return location.hash="#!/{}".format(this.handle);else for(e in this.showTitle&&(f.title.textContent=this.title,b.target.appendChild(f.title)),this.blocks)this.blocks[e].show(this.template);document.title=b.title.spec.format(b.title.text,c);m.forEach(function(a){a.classList.remove(j);a.classList.add(d)});
j=d};f.title=document.createElement("h1");var j,h=b.Block=function(a){for(var b in a)this[b]=a[b];this.template=new c(this.type)};h.prototype.show=function(a){b.target.appendChild((a||this.template).render(this))};String.prototype.format=function(a){var b=0;a="string"===typeof a?Array.apply(null,arguments):a;return this.replace(n,function(c,d,e){return a[d||e||b++]})};var n=/:(\w+)|\{([0-9])?\}/g})(this);