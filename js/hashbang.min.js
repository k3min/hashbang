(function(f){var g=f.document,q=f.location,k=g.documentElement,h=Object.defineProperty,l=Object.create,t=function(a){var c=navigator.appVersion;return/Trident/.test(c)&&c.match(/Trident\/([0-9])/)[1]<=a},d=f.HB={version:"2.0.7",endpoint:"api/:handle",collections:{},main:function(a,c){d.request=new x(d.endpoint);d.home=a||g.links[0].hash;d.root=c||f.root;d.title={text:g.title,spec:g.getElementsByTagName("title")[0].dataset.spec};d.router.fallback=d.fallback;d.router.add("/:collection(/:block)?",d.route);
d.router.match()},route:function(a,c){var b=d.collections[a];void 0===b||void 0===b.blocks||d.noCache?(b=d.collections[a]=new y,b.addEventListener("update",d.update),d.request.get({handle:a,success:b.load.bind(b),error:d.fallback})):d.request.xhr.abort();b.block=c;r.forEach(function(a){a.classList.remove("active")});r=[];for(var b=0,e=g.links;b<e.length;b++)e[b].hash.substr(3)===a&&(e[b].classList.add("active"),r.push(e[b]))},update:function(a){a=a.detail;var c=d.title,b=d.root,e=k.classList;g.title=
c.spec.format(c.text,a.title);b.replaceChildren(this);e.remove(u);e.add(u=a.handle);e.remove(v);e.add(v=a.type);b.dispatchEvent(new CustomEvent("update",{detail:this}))},fallback:function(){q.hash=d.home}},r=[],u,v,m=f.klass=function(a){var c=a.constructor,b=this&&this.prototype||!1;b&&(c.prototype=l(b,{parent:{value:b}}));for(var e in a){var b=a[e],d=e.split("$")[0],g=/\$static/.test(e)?c:c.prototype,f={enumerable:!/\$private|^constructor/.test(e)};null===b||"function"!==typeof b.get&&"function"!==
typeof b.set?(f.value=b,f.writable=/\$virtual/.test(e)||"function"!==typeof b):(f.get=b.get,f.set=b.set);h(g,d,f)}return c};h(Object.prototype,"extend",{value:m});if(void 0===g.registerElement){var n={},w=function(a,c){t(6)?Object.getOwnPropertyNames(c).forEach(function(b){h(a,b,Object.getOwnPropertyDescriptor(c,b))}):a.__proto__=c};g.registerElement=function(a,c){n[a]=c;var b=function(){var b=g.createElement(a);w(b,c.prototype);return b};b.prototype=c.prototype;h(b.prototype,"constructor",{value:b});
return b};g.addEventListener("DOMContentLoaded",function(){for(var a in n){var c;c=n[a]["extends"];c=void 0!==c?g.querySelectorAll("{}[is={}]".format(c,a)):g.getElementsByTagName(a);for(var b=0;b<c.length;b++)w(c[b],n[a].prototype),"function"===typeof c[b].attachedCallback&&c[b].attachedCallback.call(c[b])}})}void 0===f.HTMLTemplateElement&&(f.HTMLTemplateElement=HTMLElement.extend({constructor:function(){console.error("Illegal constructor")}}));d.Template=g.registerElement("hb-template",{prototype:l(HTMLTemplateElement.prototype,
{attachedCallback:{value:function(){var a=this.innerHTML,a=a.replace(/\s{2,}/g,""),a=a.replace(/\{\{(.*?)\}\}/g,"',$1,'"),a=a.split("{%").join("');"),a=a.split("%}").join("a.push('"),a="var a=[];a.push('"+a+"');return a.join('');";this.range=g.createRange();this.source=new Function(a)}},render:{value:function(a){this.range.selectNode(g.body);return this.range.createContextualFragment(this.source.call(a))}}}),"extends":"template"});var y=d.Collection=g.registerElement("hb-collection",{prototype:l(HTMLElement.prototype,
{load:{value:function(a){this.id=a.id;this.handle=a.handle;this.title=a.title;this.description=a.description;this.type=a.type;this.url=a.url;this.template=f[a.type]||f.collection||f["default"];this.blocks=a.blocks.map(function(a){return new z(a)});void 0!==this.template.dataset.sort?this.sort(this.template.dataset.sort):this.update()}},id:{get:function(){return this._id},set:function(a){this._id=a}},title:{get:function(){return this._title},set:function(a){this._title=a}},block:{get:function(){return this._block},
set:function(a){this._block=a;void 0!==this.blocks&&this.update()}},sort:{value:function(a){var c="-"===a[0]?(a=a.substr(1),-1):1;this.blocks.sort(function(b,e){b=b.reduce(a);e=e.reduce(a);return(b<e?-1:b>e?1:0)*c});this.update()}},search:{value:function(a,c){var b=l(this);b.blocks=b.blocks.filter(function(b){return b.reduce(a)===c});return b}},update:{value:function(){var a=void 0===this._block?this:this.search("handle",this._block),c={id:this.id,handle:this.handle,title:this.title,type:this.type,
template:this.template};if(void 0!==this._block){c=a.blocks[0];if(void 0===c)return q.hash="#!/"+this.handle;c={id:c.id,handle:c.handle,title:c.title,type:c.type,template:c.template}}if(void 0===c.template)return a="Template #{} is not defined".format(c.type),console.error(a);this.replaceChildren(c.template.render(a));this.dispatchEvent(new CustomEvent("update",{detail:c}))}}})}),z=d.Block=m({constructor:function(a){for(var c in a)this[c]=a[c];this.time=new Date(a.time);this.template=f[a.type]||f.block||
f["default"]},reduce:function(a){a=a.split(".");var c=this[a[0]];if(void 0!==a[1])for(var b=1;b<a.length;b++)c=c[a[b]];return c}}),A=d.Router=m({constructor:function(a){this.fallback=a||null;f.addEventListener("hashchange",this.match.bind(this))},add$private:function(a,c){var b=a,e=/\((\/:[a-z]+)\)\?/g;e.test(a)&&(a=a.replace(e,"(?:$1)?"));e=new RegExp(a.replace(/:[a-z]+/g,"([a-z0-9-]+)"),"i");this[b]=c;this[b].regExp=e},match$private:function(){var a=!0,c;for(c in this)if("fallback"!==c){var b=q.hash.match(this[c].regExp);
null!==b&&(b.shift(),this[c].apply(this,b),a=!1)}a&&"function"===typeof this.fallback&&this.fallback()}});d.router=new A;var x=d.Request=m({constructor:function(a){this.endpoint=a;this.xhr=new XMLHttpRequest;this.xhr.addEventListener("load",this.load.bind(this));this.xhr.addEventListener("error",this.fallback.bind(this))},send:function(a){var c=a.method,b=a.accept||"application/json",e=a.response||"json",d=a.data||null;k.classList.add("loading");this.success=a.success;this.error=a.error;this.xhr.open(c,
this.endpoint.format(a));this.xhr.responseType=e;this.xhr.setRequestHeader("Accept",b);"GET"!==c&&null!==d&&(a=a.type||"application/json",this.xhr.setRequestHeader("Content-Type",a),"application/json"===a&&(d=JSON.stringify(d)));this.xhr.send(d)},get:function(a){a.method="GET";this.send(a)},load:function(){k.classList.remove("loading");try{var a=this.xhr.response;200===this.xhr.status?"function"===typeof this.success&&this.success(a):this.fallback(a)}catch(c){this.fallback(c)}},fallback:function(a){k.classList.remove("loading");
void 0===a||null===a?a={status:this.xhr.status,message:this.xhr.statusText}:void 0===a.status&&(a.status=-1);"function"===typeof this.error&&this.error(a);this.debug&&console.error(a)}});void 0===f.HTMLDialogElement&&(f.HTMLDialogElement=HTMLElement.extend({constructor:function(){console.error("Illegal constructor")}}),g.registerElement("dialog",{prototype:l(HTMLElement.prototype,{returnValue:{writable:!0,value:""},open:{get:function(){return this.hasAttribute("open")},set:function(a){a?this.setAttribute("open",
""):this.removeAttribute("open")}},show:{value:function(){this.open=!0}},close:{value:function(a){void 0!==a&&(this.returnValue=a);this.dispatchEvent(new CustomEvent("close"));this.open=!1;this.returnValue=""}}})}));Node.prototype.replaceChildren=function(a){for(;this.firstChild;)this.removeChild(this.firstChild);this.appendChild(a)};String.prototype.format=function(a){var c=0;"object"!==typeof a&&(a=[].slice.call(arguments));return this.replace(/:([a-z]+)|\{([0-9])?\}/g,function(b,e,d){return a[e||
d||c++]})};Date.prototype.format=function(a){var c=Date.ordinals,b=Date.days,e=Date.months,d=this.getDate(),f=this.getDay(),g=this.getMonth(),k=this.getFullYear(),p=this.getHours(),h=p%12||12,l=this.getMinutes(),m=this.getSeconds(),n={d:10>d?"0"+d:d,D:b[f].substr(0,3),j:d,l:b[f],N:f||7,S:3<d&&20>=d?c[0]:c[d%10]||c[0],w:f,F:e[g],m:10>g?"0"+(g+1):g+1,M:e[g].substr(0,3),n:g+1,t:(new Date(k,g+1,0)).getDate(),Y:k,y:(""+k).substr(2,2),a:12>p?"am":"pm",A:12>p?"AM":"PM",g:h,G:p,h:10>h?"0"+h:h,H:10>p?"0"+
p:p,i:10>l?"0"+l:l,s:10>m?"0"+m:m};return a.replace(/\\?([a-z])/gi,function(a,b){return void 0!==n[a]?n[a]:b})};Date.ordinals=["th","st","nd","rd"];Date.days="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" ");Date.months="January February March April May June July August September October November December".split(" ");void 0===k.dataset&&h(HTMLElement.prototype,"dataset",{get:function(){for(var a={},c=this.attributes,b=0;b<c.length;b++){var d=c[b].name.split("-");void 0!==d[1]&&
"data"===d[0]&&(a[d[1]]=c[b].value)}return a}});t(7)&&(f.CustomEvent=Event.extend({constructor:function(a,c){var b=g.createEvent("CustomEvent");b.initCustomEvent(a,!1,!1,c.detail);return b}}))})(this);
